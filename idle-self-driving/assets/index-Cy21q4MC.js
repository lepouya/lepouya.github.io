var Ne=Object.defineProperty;var Fe=(t,e,s)=>e in t?Ne(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var h=(t,e,s)=>Fe(t,typeof e!="symbol"?e+"":e,s);import{r as j,j as i,c as Te,e as Be,f as Ue}from"./react-hDm2pm6D.js";import{u as We,f as qe,S as He,I as Ge,j as _e,k as Je,m as ye,n as T,o as f,q,r as Ye,s as Ke,t as Qe,v as Ze,w as Xe,x as Ve,y as Me,z as $e,A as et,B as E,C as tt,D as P,E as B,F as st,G as it,J as nt,K as he,L as de,M as ge,N as ie,O as ue,P as Ce,Q as xe,R as rt,T as at,U as ot}from"./ionic-Dzo8aPBz.js";import{p as Pe,r as De,I as ct,b as lt,a as ht,c as dt}from"./ionicons-CfHZMLmn.js";function Bt(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function s(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(a){if(a.ep)return;a.ep=!0;const n=s(a);fetch(a.href,n)}})();function M(t=0,e=0,s=1){return isNaN(t)||t<e?e:t>s?s:t}class gt extends Error{}class Ae extends Error{}class ut{constructor(e,s){h(this,"canvas");h(this,"options");this.canvas=e,this.options=s}get dataURL(){return this.canvas.toDataURL(this.options.format,this.options.quality)}get blob(){return new Promise((e,s)=>this.canvas.toBlob(r=>r?e(r):s(new Ae),this.options.format,this.options.quality))}getPixels(e,s,r,a){var w,y;const n=this.canvas.width,o=this.canvas.height,c=ce(e,0,n-1),l=ce(s,0,o-1),g=ce(r,1,n-c),d=ce(a,1,o-l),u=(y=(w=this.canvas)==null?void 0:w.getContext("2d",{alpha:!1}))==null?void 0:y.getImageData(c,l,g,d);if(!u)throw new Ae;return{buffer:new Uint32Array(u.data.buffer),startX:c-e,startY:l-s,width:g,height:d}}}async function se(t,e){var c,l,g,d,u,k,w,y,C;const s=Object.assign({},mt,e),r=[...t||[],...(s==null?void 0:s.sources)||[]],a=await Promise.all(r.map(I=>ft(I,s)));let n=s.reuse instanceof HTMLCanvasElement?s.reuse:(c=s.reuse)==null?void 0:c.canvas;n||(n=window.document.createElement("canvas")),n.width=s.width||Math.max(...a.map(([I])=>I.width)),n.height=s.height||Math.max(...a.map(([I])=>I.height)),n.className=[...Array.isArray(s.className)?s.className:[s.className],"composed-image"].join(" "),s.style&&Object.assign(n.style,s.style);const o=n.getContext("2d");s.clear&&o.clearRect(0,0,n.width,n.height);for(let[I,m]of a){o.save();let U=$(m.crop,0,"x")||0,W=$(m.crop,1,"y")||0,O=$(m.crop,2,"w")||I.width,z=$(m.crop,3,"h")||I.height,v=$(m.position,0,"x")||0,L=$(m.position,1,"y")||0,N=($(m.stretch,0,"sx")||1)*O,R=($(m.stretch,1,"sy")||1)*z,X=($(m.rotate,2,"a")||0)*(Math.PI/180),V=typeof m.rotate=="number"?void 0:m.rotate,ee=((l=$(V,0,"x"))!=null?l:.5)*N+v,te=((g=$(V,1,"y"))!=null?g:.5)*R+L,x=(d=$(m.scale,2,"sx"))!=null?d:1,F=(u=$(m.scale,3,"sy"))!=null?u:1,ve=typeof m.scale=="number"?void 0:m.scale,be=((k=$(ve,0,"x"))!=null?k:.5)*N+v,Ie=((w=$(ve,1,"y"))!=null?w:.5)*R+L;o.globalAlpha=(y=m.opacity)!=null?y:1,o.globalCompositeOperation=(C=m.composition)!=null?C:"source-over",o.imageSmoothingEnabled=m.smoothing!==!1&&m.smoothing!=="disabled",o.imageSmoothingQuality=m.smoothing==="medium"||m.smoothing==="high"?m.smoothing:"low",Array.isArray(m.filter)?o.filter=m.filter.join(" "):m.filter&&(o.filter=m.filter),o.filter||(o.filter="none"),o.resetTransform(),X!==0&&(o.translate(ee,te),o.rotate(X),o.translate(-ee,-te)),(x!==1||F!==1)&&(o.translate(be,Ie),o.scale(x,F),o.translate(-be,-Ie)),o.imageSmoothingEnabled||(U=~~U,W=~~W,O=~~O,z=~~z,v=~~v,L=~~L,N=~~N,R=~~R),o.drawImage(I,U,W,O,z,v,L,N,R),o.restore()}return new ut(n,s)}function ft(t,e){return new Promise((s,r)=>{var o,c,l,g;const a=typeof t=="string"?{src:t}:t;a.src=(a.src||"").trim(),!a.src||a.src==="transparent"?a.src=xt:a.src.startsWith("plain:")?a.src=pt.replace("{color}",encodeURIComponent(a.src.slice(6).trim())).replace("{width}",((o=e==null?void 0:e.width)==null?void 0:o.toString())||"100%").replace("{height}",((c=e==null?void 0:e.height)==null?void 0:c.toString())||"100%"):a.src.startsWith("<svg")&&(a.src.includes("xmlns=")||(a.src=a.src.replace("<svg",'<svg xmlns="http://www.w3.org/2000/svg"')),a.src="data:image/svg+xml;utf8,"+encodeURIComponent(a.src.replace("{width}",((l=e==null?void 0:e.width)==null?void 0:l.toString())||"100%").replace("{height}",((g=e==null?void 0:e.height)==null?void 0:g.toString())||"100%")));const n=new Image;n.onerror=()=>r(new gt),n.onload=()=>s([n,a]),n.crossOrigin="anonymous",n.src=a.src})}const mt={format:"image/png",quality:.92},xt="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",pt='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1 1" preserveAspectRatio="none"     width="{width}" height="{height}">  <rect x="0" y="0" width="1" height="1" fill="{color}" /></svg>';function $(t,...e){let s;if(!t||typeof t=="number")s=t!=null?t:void 0;else if(Array.isArray(t)){for(let r of e)if(typeof r=="string"&&(r=parseInt(r)),typeof r=="number"&&isFinite(r)){const a=t[r];if(a!=null&&typeof a=="number"){s=a;break}}}else if(typeof t=="object"){for(let r of e)if(typeof r=="string"||typeof r=="number"){const a=t[r];if(a!=null&&typeof a=="number"){s=a;break}}}for(let r of e)r&&typeof r=="object"&&(r.def!=null&&s==null&&(s=r.def),r.min!=null&&s!=null&&(s=Math.max(s,r.min)),r.max!=null&&s!=null&&(s=Math.min(s,r.max)));return s}function ce(t=0,e=0,s=1){return isNaN(t)||t<e?~~e:t>s?~~s:~~t}function oe(t){const e={};function s(){return typeof t=="function"?t():t}function r(){return Date.now().toString(36)+Math.random().toString(36).slice(1)}function a(g,d){const u=d||r();return e[u]=g,u}function n(g){delete e[g]}function o(){return e}function c(){const g={ref:s()};Object.values(e).forEach(d=>d(g))}function l(){const[g,d]=j.useState(r),[u,k]=j.useState(()=>({ref:s()}));return j.useEffect(()=>{const w=a(k,g);return d(w),()=>{n(g),n(w)}},[g]),We(()=>{const w=a(k,g);d(w)},[g]),qe(()=>{n(g)},[g]),u.ref}return{useHook:l,signal:c,register:a,unregister:n,getRegistry:o,get:s}}function fe(t){if(fe.skipEncoding||!t)return t;const e=t.startsWith(".."),s=(e?t:Math.random().toString(36)).substring(2,10);return(e?"":".."+s)+(e?t.slice(10):t).split("").map(r=>r.charCodeAt(0)).map((r,a)=>String.fromCharCode(r^s.charCodeAt(a%8))).join("")}fe.skipEncoding=!1;function kt(t,e){const s=[];function r(a,n){if(!(a&&a.startsWith("_")))return!n||typeof n!="object"||Array.isArray(n)?n:n instanceof Date?n.toJSON():Object.keys(n).length===0||s.includes(n)?void 0:(s.push(n),n)}return JSON.stringify(t,r,e)}function me(t,e=!1){const s=kt(t,e?2:void 0);return e?s:window.btoa(fe(encodeURIComponent(s)))}function je(t){if(!t||typeof t!="string")return t!=null?t:void 0;try{const e=JSON.parse(decodeURIComponent(fe(window.atob(t))));if(e)return e}catch(e){}try{const e=JSON.parse(t);if(e)return e}catch(e){}return t}const _={db:void 0};function D(){return D.initialize(),_.db}D.initialize=async function(){return _.db||(_.db=new He,_.db=await _.db.create()),_.db};D.write=async function(t,e,s=!1){const r=me(e,s),a=await D.initialize();return await(a==null?void 0:a.set(t,r))};D.read=async function(t){const e=await D.initialize(),s=await(e==null?void 0:e.get(t));return je(s)};D.clear=async function(){const t=await D.initialize();await(t==null?void 0:t.clear())};function A(t,e){A.register(t,e)}A.register=function(t,e){var s;t=t.toLowerCase().replace(/\W/g,""),(s=J[t])!=null||(J[t]=[]),J[t].includes(e)||J[t].push(e)};A.addEventListeners=function(){document.addEventListener("keydown",Re),document.addEventListener("keyup",Ee),Oe()};A.removeEventListeners=function(){document.removeEventListener("keydown",Re),document.removeEventListener("keyup",Ee),Oe()};A.test=function(t){var e;return(e=ne[t.toLowerCase().replace(/\W/g,"")])!=null?e:!1};A.some=function(...t){return t.some(A.test)};A.all=function(...t){return t.every(A.test)};const wt=["TEXTAREA","INPUT"],J={},ne={};function Re(t){if(ze(t.target))return;const e=t.key.toLowerCase().replace(/\W/g,"");ne[e]=!0;const s=J[e];s&&s.length>0&&s.forEach(r=>{r(t)&&(t.preventDefault(),t.stopPropagation())})}function Ee(t){if(ze(t.target))return;const e=t.key.toLowerCase().replace(/\W/g,"");ne[e]=!1}function Oe(){Object.keys(ne).forEach(t=>ne[t]=!1)}function ze(t){try{return t&&wt.includes(t.tagName.toUpperCase())}catch(e){return!1}}function yt(t=0,e=1){const s=1-Math.random(),r=Math.random();return Math.sqrt(-2*Math.log(s))*Math.cos(2*Math.PI*r)*e+t}class re{constructor(e){this.config=e,this.validate(),this.regularize()}static init(e,s,r){if(!e)throw new Error("Invalid input count");if(!s)throw new Error("Invalid output count");r||(r=[]);const a=[];for(let n=0;n<r.length+1;n++){const o=n===0?e:r[n-1],c=n===r.length?s:r[n],l=[];for(let g=0;g<c;g++){const d=[];for(let u=0;u<o+1;u++)d.push(0);l.push(d)}a.push(l)}return new re({input:e,output:s,hidden:r,weights:a})}validate(){const{input:e,hidden:s,output:r,weights:a}=this.config;if(e<1)throw new Error("Invalid input count");if(s.length<0)throw new Error("Invalid hidden layer count");if(r<1)throw new Error("Invalid output count");if(a.length!==s.length+1)throw new Error("Invalid weight count");for(let n=0;n<a.length;n++){const o=n===0?e:s[n-1],c=n===s.length?r:s[n];if(a[n].length!==c)throw new Error("Invalid row count for weights layer ".concat(n));for(let l=0;l<a[n].length;l++)if(a[n][l].length!==o+1)throw new Error("Invalid col count for weights layer ".concat(n," neuron ").concat(l))}}regularize(){const e=this.config.weights,s=2;for(let r=0;r<e.length;r++)for(let a=0;a<e[r].length;a++)for(let n=0;n<e[r][a].length;n++)e[r][a][n]=M(e[r][a][n],-2,s)}eval(e){const s=this.config.weights;let r=e;for(let a=0;a<s.length;a++){let n=[];for(let o=0;o<s[a].length;o++){let c=s[a][o][r.length-1];for(let l=0;l<r.length-1;l++)c+=r[l]*s[a][o][l];n.push(this.activation(c))}r=n}return r}activation(e){return e<-1?-1:e>1?1:e}randomStep(e){return new re({...this.config,weights:this.config.weights.map(s=>s.map(r=>r.map(a=>yt(a,e))))})}}class Q{constructor(e,s="",r=.5,a=!0){h(this,"renderImage");h(this,"sensorImage");h(this,"width",p.singleton.carWidth);h(this,"height",p.singleton.carHeight);h(this,"track",null);h(this,"position",{x:0,y:0});h(this,"angle",0);h(this,"speed",0);h(this,"steering",0);h(this,"acceleration",0);h(this,"odometer",0);h(this,"laps",0);h(this,"inCrossing",!1);h(this,"totalTicks",0);h(this,"startTime",0);h(this,"endTime",0);h(this,"collided",!1);h(this,"pastTracking",[]);h(this,"sensorsReady",!0);h(this,"sensorReadingTime",0);h(this,"sensorReadings",[]);h(this,"visualizeSensors",!1);h(this,"net",null);if(this.name=e,this.color=s,this.fudgeFactor=r,!s){const n=[32,64,128].map(o=>M(~~(Math.random()*o*2),0,255));this.color="#"+n.map(o=>o.toString(16).padStart(2,"0")).join("")}e&&a&&(Q.registry.get()[e]=this)}get mask(){return['<svg\n        width="'.concat(this.width,'px"\n        height="').concat(this.height,'px"\n        viewBox="0 0 ').concat(this.width," ").concat(this.height,'"\n      >'),'<rect\n        width="'.concat(this.width,'"\n        height="').concat(this.height,'"\n        rx="').concat(this.width/4,'"\n        ry="').concat(this.height/4,'"\n        fill="').concat(b.color.vehicle,'"\n        shape-rendering="crispEdges"\n      />'),"</svg>"].join("")}get image(){return['<svg\n        width="'.concat(this.width,'px"\n        height="').concat(this.height,'px"\n        viewBox="0 0 ').concat(this.width," ").concat(this.height,'"\n      >'),'<rect\n        width="'.concat(this.width,'"\n        height="').concat(this.height,'"\n        rx="').concat(this.width/4,'"\n        ry="').concat(this.height/4,'"\n        fill="').concat(this.laps>=3?"green":this.collided?"red":this.color,'"\n      />'),[[0,0],[this.width*3/4,0],[this.width*3/4,this.height*3/4],[0,this.height*3/4]].map(([e,s])=>'<rect\n            x="'.concat(e,'"\n            y="').concat(s,'"\n            width="').concat(this.width/4,'"\n            height="').concat(this.height/4,'"\n            rx="').concat(this.width/8,'"\n            ry="').concat(this.height/8,'"\n            fill="black"\n          />')),"</svg>"].join("")}get canvas(){var e;return(e=this.renderImage)==null?void 0:e.canvas}async fetchImageData(){return this.renderImage=await se([],{reuse:this.renderImage,clear:!0,sources:[{src:this.image,opacity:this.net?.666:1}],width:this.width,height:this.height}),this.renderImage}get score(){const e=Date.now(),s=this.odometer/Math.max(this.width,this.height),r=((this.endTime||e)-(this.startTime||e))/1e3;return{distance:s,time:r,laps:this.laps,success:!this.collided&&this.laps>=3&&this.startTime>0,score:this.startTime>0?Math.max(0,s-r)+(this.laps+1)**2*10:0}}placeOnTrack(e){this.track=e,this.position.x=e.startingPoint.x,this.position.y=e.startingPoint.y,this.angle=e.startingAngle,this.speed=0,this.steering=0,this.acceleration=0,this.position.x-=e.startingDirection.x*this.width/2,this.position.y-=e.startingDirection.y*this.height/2;const s=this.net?Math.random()*e.roadThickness-e.roadThickness/2:0;this.position.x+=s*this.fudgeFactor*e.startingDirection.y,this.position.y-=s*this.fudgeFactor*e.startingDirection.x,this.odometer=0,this.laps=0,this.inCrossing=!1,this.startTime=0,this.endTime=0,this.collided=!1,this.fetchImageData();const r=Math.max(this.width,this.height,this.track.roadThickness)+1;this.pastTracking=[{x:e.startingPoint.x-e.startingDirection.x*r,y:e.startingPoint.y-e.startingDirection.y*r}],this.sensorsReady=!0,this.sensorReadingTime=Date.now()}endRun(e=!0){var r,a;this.endTime=Date.now(),this.startTime||(this.startTime=this.endTime),this.inCrossing=!1,this.collided=e,this.fetchImageData();const s=p.singleton;this.track&&this.net&&this.score.score>((a=(r=s.sotaScore[this.track.name])==null?void 0:r.score)!=null?a:0)&&(s.sotaNet=this.net.config,s.sotaScore={[this.track.name]:this.score})}render(e,s=!1){if(this.canvas){if(e.save(),e.resetTransform(),e.translate(~~this.position.x,~~this.position.y),e.rotate(this.angle),(this.visualizeSensors||this.name==="Manual")&&b.registry.get().forEach((r,a)=>r.render(e,this.sensorReadings[a])),e.drawImage(this.canvas,~~(-this.width/2),~~(-this.height/2)),s){const r=Math.abs(Math.sin(Date.now()/200)+1);e.filter="blur(".concat(r*5,"px) brightness(").concat(r*100,"%)"),e.drawImage(this.canvas,~~(-this.width/2),~~(-this.height/2))}e.restore()}}tick(e){if(this.collided||!this.track)return;if(this.name==="Manual")this.manualControl();else{const n=this.score;if(n.score<-10||this.totalTicks>3&&n.laps===0&&n.score<=n.time)return console.log(this.name,"doesn't seem to be going anywhere"),this.endRun();if(n.laps>=3)return this.endRun()}const s=p.singleton;if(this.totalTicks+=e,this.steering=M(this.steering,-1,1),this.steering=M(this.steering,-this.speed,this.speed),Math.abs(this.steering)>=.01&&(this.angle+=s.maxSteering*this.steering*e,this.steering-=s.friction*Math.sign(this.steering)*e,this.speed-=s.friction*this.speed*e),this.angle>Math.PI?this.angle-=Math.PI*2:this.angle<-Math.PI&&(this.angle+=Math.PI*2),this.acceleration=M(this.acceleration,-1,1),Math.abs(this.acceleration)>=.01?(this.speed+=s.maxAcceleration*this.acceleration*e,this.acceleration-=s.friction*Math.sign(this.acceleration)*e):this.speed-=s.friction*this.speed*e,this.speed=M(this.speed,0,s.maxSpeed),this.position.x+=Math.cos(this.angle)*this.speed*e,this.position.y+=Math.sin(this.angle)*this.speed*e,this.odometer+=this.speed*e,this.position.x<=0||this.position.x>=this.track.width||this.position.y<=0||this.position.y>=this.track.height)return console.log(this.name,"went out of bounds"),this.endRun();const r=Math.max(this.width,this.height,this.track.roadThickness),a=this.pastTracking.map(n=>Math.hypot(n.x-this.position.x,n.y-this.position.y));if(a.length===0||a.every(n=>n>r))this.pastTracking.unshift({x:this.position.x,y:this.position.y}),this.pastTracking.length>3&&this.pastTracking.pop();else if(a.length>1&&a.slice(1).some(n=>n<r))return console.log(this.name,"went back on the track"),this.endRun();this.checkSensors()}async renderSensors(){var e;return se([],{width:p.singleton.trackWidth,height:p.singleton.trackHeight,sources:[{src:((e=this.track)==null?void 0:e.mask)||"transparent",smoothing:!1},{src:this.mask,position:{x:this.position.x-this.width/2,y:this.position.y-this.height/2},rotate:this.angle*(180/Math.PI),composition:"lighter",smoothing:!1},...b.registry.get().map(s=>({src:s.mask,position:{x:this.position.x-s.range,y:this.position.y-s.range},rotate:this.angle*(180/Math.PI),composition:"lighter",smoothing:!1}))]})}checkSensors(){if(!(!this.track||this.collided)&&!(!this.sensorsReady&&Date.now()-this.sensorReadingTime<100))return this.sensorsReady=!1,se([],{width:this.track.width,height:this.track.height,reuse:this.sensorImage,clear:!0,sources:[{src:this.track.mask,smoothing:!1},{src:this.mask,position:{x:this.position.x-this.width/2,y:this.position.y-this.height/2},rotate:this.angle*(180/Math.PI),composition:"lighter",smoothing:!1}]}).then(e=>{if(this.sensorImage=e,this.checkCollision(e))return this.endRun();if(this.sensorReadings=b.readAll(e,this.position.x,this.position.y,this.angle),this.net){const r=this.net.eval([...this.sensorReadings,this.acceleration,this.steering,this.speed/p.singleton.maxSpeed,this.angle/Math.PI]);this.acceleration=r[0],this.steering=r[1]}}).catch(e=>{console.error("Error reading sensors",this.name,e)}).finally(()=>{this.sensorsReady=!0,this.sensorReadingTime=Date.now()})}checkCollision(e){const s=~~Math.max(this.width/2,this.height/2)+1,r=e.getPixels(this.position.x-s,this.position.y-s,s*2,s*2).buffer,a=r.some(g=>b.check(g,b.vehicle,b.lapLine)),n=r.some(g=>b.check(g,b.vehicle,b.offTrack)),o=this.angle,c=this.track.startingAngle;let l=Math.abs((o<0?o+Math.PI*2:o)-(c<0?c+Math.PI*2:c));if(l>Math.PI&&(l=Math.PI*2-l),a&&!this.inCrossing){if(this.inCrossing=!0,l>Math.PI/2)return console.log(this.name,"crossed the lap line the wrong way"),!0;if(!this.startTime)this.startTime=Date.now();else{if(this.odometer<this.width+this.height)return console.log(this.name,"didn't complete a full lap"),!0;this.laps++,console.log(this.name,"has completeted lap",this.laps,this.score.score)}}else if(!a&&this.inCrossing&&(this.inCrossing=!1,l>Math.PI/2))return console.log(this.name,"turned around on the lap line"),!0;return n?(console.log(this.name,"went off track"),!0):!1}manualControl(){A.some("ArrowDown","S")?this.acceleration=M(this.acceleration-.1,-1,-.1):A.some("ArrowUp","W")?this.acceleration=M(this.acceleration+.1,.1,1):this.acceleration=0,A.some("ArrowLeft","A")?this.steering=M(this.steering-.1,-1,-.1):A.some("ArrowRight","D")?this.steering=M(this.steering+.1,.1,1):this.steering=0}}(t=>{t.registry=oe({});function e(n){Object.values(t.registry.get()).sort((c,l)=>l.score.score-c.score.score).forEach((c,l)=>c.render(n,l===0))}t.renderAll=e;function s(n){var o;if(Object.values(t.registry.get()).forEach(c=>c.tick(n)),p.singleton.autoAdvance){const c=Object.values(t.registry.get());if(c.every(l=>l.collided||l.name==="Manual")){const l=(o=c[0])==null?void 0:o.track;l&&r(l,!1)}}}t.tickAll=s;async function r(n,o=!1){var m,U,W,O,z,v,L,N,R,X,V,ee,te;const c=p.singleton,l=t.registry.get();c.manualControl&&(!l.Manual||((U=(m=l.Manual)==null?void 0:m.collided)==null||U)||((z=(O=(W=l.Manual)==null?void 0:W.track)==null?void 0:O.name)!=null?z:"")!==n.name)?new t("Manual","#33eeee").placeOnTrack(n):!c.manualControl&&l.Manual&&delete l.Manual;const g=Object.values(l).filter(x=>x.name!=="Manual"&&x.net);if(!o&&g.some(x=>!x.collided&&x.track===n))return;g.forEach(x=>x.endRun()),g.sort((x,F)=>F.score.score-x.score.score);const d=new re(c.sotaNet),u=c.sotaScore[n.name],k=(L=(v=g[0])==null?void 0:v.net)!=null?L:d,w=(R=(N=g[0])==null?void 0:N.score)!=null?R:u,y=Math.floor(Math.random()*g.length),C=(V=(X=g[y])==null?void 0:X.net)!=null?V:k,I=(te=(ee=g[y])==null?void 0:ee.score)!=null?te:w;for(let x=0;x<c.numSimulations.globalBest;x++){const F=new t("AI.globalBest.".concat(x));F.net=d.randomStep(x===0?0:a(u))}for(let x=0;x<c.numSimulations.trackBest;x++){const F=new t("AI.trackBest.".concat(x));F.net=k.randomStep(x===0&&(w==null?void 0:w.score)!==(u==null?void 0:u.score)?0:a(w))}for(let x=0;x<c.numSimulations.trackRandom;x++){const F=new t("AI.trackRandom.".concat(x));F.net=C.randomStep(a(I))}c.numIterations++,console.log("Starting iteration",c.numIterations),Object.values(l).forEach(x=>{x.track||x.placeOnTrack(n)}),await Promise.all(Object.values(l).map(x=>x.fetchImageData())),p.save(),t.registry.signal()}t.nextGeneration=r;function a(n){return!n||!n.score||!n.distance||!n.time?1:M(Math.sqrt(10/n.score),.1,1)}})(Q||(Q={}));function jt(){const t=Q.registry.useHook();return Object.values(t)}const Y=Q,K=class K{constructor(e){h(this,"ticksPerSec",100);h(this,"rendersPerSec",30);h(this,"saveFrequencySecs",60);h(this,"minUpdateSecs",.01);h(this,"maxUpdateSecs",.25);h(this,"maxTickSecs",.1);h(this,"globalTimeDilation",1);h(this,"globalPaused",!1);h(this,"lastReset",Date.now());h(this,"lastSaved",0);h(this,"lastLoaded",Date.now());h(this,"lastRender",0);h(this,"lastTick");h(this,"onTickComplete");h(this,"execution",{});h(this,"helpDismissed");h(this,"trackWidth",800);h(this,"trackHeight",600);h(this,"currentTrack","Basic");h(this,"autoAdvance",!1);h(this,"carWidth",20);h(this,"carHeight",15);h(this,"friction",.1);h(this,"maxSpeed",100);h(this,"maxAcceleration",25);h(this,"maxSteering",Math.PI/2);h(this,"manualControl",!1);h(this,"renderSensors",!1);h(this,"sensors",[{range:100,angle:0},{range:100,angle:Math.PI/6},{range:100,angle:-Math.PI/6},{range:100,angle:Math.PI/3},{range:100,angle:-Math.PI/3}]);h(this,"numIterations",0);h(this,"numSimulations",{globalBest:4,trackBest:4,trackRandom:2});h(this,"sotaScore",{});h(this,"sotaNet",re.init(this.sensors.length+4,2,[]).config);this.load(e),K.singleton=this}isDebug(){return window.location.search.toLowerCase().includes("debug")}set(e){let s;for(s in e)e[s]==null||e[s]==null||(typeof this[s]=="object"&&typeof e[s]=="object"?Object.assign(this[s],e[s]):this[s]=e[s]);return K.registry.signal(),this}load(e){if(e){if(typeof e=="string")return this.load(JSON.parse(e))}else return this;return this.set(e),this.lastLoaded=Date.now(),this}save(){return this.lastSaved=Date.now(),this}tick(e=Date.now(),s="unknown",r,a){var u,k,w;const n=(u=this.lastTick)!=null?u:e;let o=M((e-n)/1e3,0,this.maxUpdateSecs);if(o<this.minUpdateSecs&&this.lastTick!=null)return[];this.lastTick=e;const c=e-o*1e3,l={},g=1/this.globalTimeDilation,d=[o,1];for(;o>0;){const y=M(o,this.minUpdateSecs,this.maxTickSecs);o-=y,s==="tick"&&Y.tickAll(this.globalPaused?0:y*g)}return this.execution[s]={lastTick:e,lastDelta:(e-c)/1e3,lastResult:Object.values(l).flat().filter((y,C,I)=>I.indexOf(y)===C),tps:(((k=this.execution[s])==null?void 0:k.tps)||0)*.8+d[1]/d[0]*.2,fps:((w=this.execution[s])==null?void 0:w.fps)||0},this.onTickComplete&&this.onTickComplete((e-c)/1e3,s),r&&this.lastTick-this.lastSaved>=this.saveFrequencySecs*1e3&&this.lastTick-this.lastLoaded>=this.saveFrequencySecs*1e3&&(this.lastSaved=this.lastTick,r(this)),a&&this.lastTick-this.lastRender>=1e3/this.rendersPerSec&&(this.execution[s].fps=(this.execution[s].fps||0)*.8+1e3/(this.lastTick-this.lastRender)*.2,this.lastRender=this.lastTick,a(this)),this.execution[s].lastResult}};h(K,"singleton",new K);let p=K;(t=>{t.registry=oe(()=>t.singleton);async function e(){t.singleton.tick(void 0,"save");const l=await D.write("Settings",t.singleton.save());return t.registry.signal(),l}t.save=e;async function s(){return t.singleton.load(await D.read("Settings")),t.singleton.tick(void 0,"load"),t.registry.signal(),t.singleton}t.load=s;function r(l){return t.singleton=new t(l),t.registry.signal(),t.singleton}t.reset=r;function a(l,g){return t.singleton.tick(l,g,e,t.registry.signal)}t.tick=a;const n=[];function o(){c();const l=setInterval(()=>a(void 0,"tick"),1e3/t.singleton.ticksPerSec);n.push(l)}t.addTickTimer=o;function c(){n.forEach(l=>clearInterval(l)),n.length=0}t.removeTickTimer=c})(p||(p={}));function Z(){return p.registry.useHook()}class b{constructor(e,s){h(this,"renderImage");h(this,"path");this.range=e,this.angle=s;const r=e*Math.cos(s),a=e*Math.sin(s);this.path="M ".concat(~~e," ").concat(~~e," l ").concat(~~r," ").concat(~~a)}get maskColor(){return b.radar}get mask(){return['<svg\n        width="'.concat(this.range*2,'px"\n        height="').concat(this.range*2,'px"\n        viewBox="0 0 ').concat(this.range*2," ").concat(this.range*2,'"\n      >'),'<path\n        d="'.concat(this.path,'"\n        stroke="').concat(b.color.radar,'"\n        stroke-width="2px"\n        stroke-linecap="butt"\n        fill="none"\n        shape-rendering="crispEdges"\n      />'),"</svg>"].join("")}get image(){return['<svg\n        width="'.concat(this.range*2,'px"\n        height="').concat(this.range*2,'px"\n        viewBox="0 0 ').concat(this.range*2," ").concat(this.range*2,'"\n      >'),'<path\n        d="'.concat(this.path,'"\n        stroke="green"\n        stroke-width="2px"\n        stroke-linecap="round"\n        fill="none"\n      />'),"</svg>"].join("")}get canvas(){var e;return(e=this.renderImage)==null?void 0:e.canvas}async fetchImageData(){return this.renderImage=await se([this.image],{reuse:this.renderImage,clear:!0,width:this.range*2,height:this.range*2}),this.renderImage}render(e,s=1){if(!this.canvas)return;const r=~~this.range,a=~~(this.range*s);e.globalCompositeOperation="lighter",e.drawImage(this.canvas,-r,-r,r*2,r*2),e.globalCompositeOperation="source-over",e.drawImage(this.canvas,-a,-a,a*2,a*2)}read(e,s,r,a,n,o){const c=Math.cos(this.angle+o),l=Math.sin(this.angle+o);let g=0;for(let d=0;d<this.range;d++){const u=M(~~(n+d*l),0,r-1),k=M(~~(a+d*c),0,s-1);if(b.check(e[u*s+k],b.offTrack))break;g=d}return M(g/this.range,0,1)}}(t=>{t.available=0,t.offTrack=8388608,t.lapLine=32768,t.vehicle=8355711,t.radar=128,t.color={available:e(t.available),offTrack:e(t.offTrack),lapLine:e(t.lapLine),vehicle:e(t.vehicle),radar:e(t.radar)};function e(o){return"#"+o.toString(16).padStart(6,"0")}function s(o){return(o&16711680)>>16|(o&255)<<16|o&65280}function r(o,...c){const l=s(c.reduce((g,d)=>g|d,0));return(o&l)===l}t.check=r,t.registry=oe([]);async function a(){const o=p.singleton.sensors.map(({range:c,angle:l})=>new t(c,l));o.forEach(c=>t.registry.get().push(c)),await Promise.all(o.map(c=>c.fetchImageData())),t.registry.signal()}t.loadAll=a;function n(o,c,l,g){const d=~~Math.max(...t.registry.get().map(I=>I.range)),{buffer:u,startX:k,startY:w,width:y,height:C}=o.getPixels(~~c-d,~~l-d,d*2,d*2);return t.registry.get().map(I=>I.read(u,y,C,d-k,d-w,g))}t.readAll=n})(b||(b={}));class H{constructor(e){h(this,"renderImage");h(this,"width",p.singleton.trackWidth);h(this,"height",p.singleton.trackHeight);this.name=e}get startingAngle(){return Math.atan2(this.startingDirection.y,this.startingDirection.x)}get mask(){return['<svg\n        width="'.concat(this.width,'px"\n        height="').concat(this.height,'px"\n        viewBox="0 0 ').concat(this.width," ").concat(this.height,'"\n      >'),'<rect\n        width="'.concat(this.width,'"\n        height="').concat(this.height,'"\n        fill="').concat(b.color.offTrack,'"\n        shape-rendering="crispEdges"\n      />'),this.path.map(e=>'<path\n            d="'.concat(e,'"\n            stroke="').concat(b.color.available,'"\n            stroke-width="').concat(this.roadThickness,'px"\n            stroke-linecap="round"\n            stroke-linejoin="round"\n            fill="none"\n            shape-rendering="crispEdges"\n          />')),'<path\n        d="M '.concat(this.startingPoint.x," ").concat(this.startingPoint.y," l ").concat(Math.sign(this.startingDirection.x)*this.laneMarkingThickness," ").concat(Math.sign(this.startingDirection.y)*this.laneMarkingThickness,'"\n        stroke="').concat(b.color.lapLine,'"\n        stroke-width="').concat(this.roadThickness,'px"\n        stroke-linecap="butt"\n        fill="none"\n      />'),"</svg>"].join("")}get image(){return['<svg\n        width="'.concat(this.width,'px"\n        height="').concat(this.height,'px"\n        viewBox="0 0 ').concat(this.width," ").concat(this.height,'"\n      >'),'<rect\n        width="'.concat(this.width,'"\n        height="').concat(this.height,'"\n        fill="lightgreen"\n      />'),this.path.map(e=>'<path\n            d="'.concat(e,'"\n            stroke="salmon"\n            stroke-width="').concat(this.roadThickness+this.laneMarkingThickness*2,'px"\n            stroke-linecap="round"\n            stroke-linejoin="round"\n            fill="none"\n          />')),this.path.map(e=>'<path\n            d="'.concat(e,'"\n            stroke="lightgray"\n            stroke-width="').concat(this.roadThickness,'px"\n            stroke-linecap="round"\n            stroke-linejoin="round"\n            fill="none"\n          />')),this.path.map(e=>'<path\n            d="'.concat(e,'"\n            stroke="yellow"\n            stroke-width="').concat(this.laneMarkingThickness,'px"\n            stroke-dasharray="\n              ').concat(this.laneMarkingThickness*3,",\n              ").concat(this.laneMarkingThickness*5,'"\n            stroke-dashoffset="').concat(this.laneMarkingThickness,'"\n            stroke-linecap="round"\n            stroke-linejoin="round"\n            fill="none"\n          />')),'<path\n        d="M '.concat(this.startingPoint.x," ").concat(this.startingPoint.y," l ").concat(Math.sign(this.startingDirection.x)*this.laneMarkingThickness," ").concat(Math.sign(this.startingDirection.y)*this.laneMarkingThickness,'"\n        stroke="white"\n        stroke-width="').concat(this.roadThickness,'px"\n        stroke-linecap="butt"\n        fill="none"\n      />'),"</svg>"].join("")}get canvas(){var e;return(e=this.renderImage)==null?void 0:e.canvas}async fetchImageData(){return this.renderImage=await se([this.image],{reuse:this.renderImage,clear:!0,width:this.width,height:this.height}),this.renderImage}render(e){this.canvas&&e.drawImage(this.canvas,0,0)}}(t=>{t.registry=oe({});async function e(){const s=[new bt("Basic"),new It("Advanced"),new Tt("Oval"),new Mt("Curvy")];s.forEach(r=>{t.registry.get()[r.name]=r}),await Promise.all(s.map(r=>r.fetchImageData())),t.registry.signal()}t.loadAll=e})(H||(H={}));function vt(){return H.registry.useHook()}const Le=H;class bt extends H{get path(){return["M 730 70 h -360 v 200 h -300 v 260 h 400 l 260 -260 v -160 Z"]}get roadThickness(){return 80}get laneMarkingThickness(){return 3}get startingPoint(){return{x:150,y:530}}get startingDirection(){return{x:1,y:0}}}class It extends H{get path(){return["M 750 50 h -300 l -200 100 l -100 -70 h -100 v 450 h 300 v -150 h 50 v -200 h 100 v 380 h 150 Z"]}get roadThickness(){return 60}get laneMarkingThickness(){return 3}get startingPoint(){return{x:600,y:50}}get startingDirection(){return{x:1,y:0}}}class Tt extends H{get path(){return["M 400 100 Q 100 100 100 300 T 400 500 T 700 300 T 400 100 Z"]}get roadThickness(){return 100}get laneMarkingThickness(){return 3}get startingPoint(){return{x:400,y:100}}get startingDirection(){return{x:-1,y:0}}}class Mt extends H{get path(){return["M 100 300 c 0 100 50 200 150 200 s 50 -150 150 -150 s 50 150 150 150 s 150 -100 150 -200 s 0 -100 -100 -100 s -100 0 -100 -100 s 0 0 -100 0 s 0 0 -100 0 s 0 -50 -100 -50 s -100 150 -100 250 Z"]}get roadThickness(){return 70}get laneMarkingThickness(){return 3}get startingPoint(){return{x:400,y:100}}get startingDirection(){return{x:-1,y:0}}}const $t=Ge,At=_e,St=Je;function Ct(){const t=Z(),e=j.useRef(null),[s,r]=j.useState(),[a,n]=j.useState();return j.useEffect(()=>{(async()=>{const c=new Pt("Demo Track"),l=new Y("","#33eeee",0,!1);l.visualizeSensors=!0,await Promise.all([c.fetchImageData(),l.fetchImageData()]),l.placeOnTrack(c),l.position={x:100,y:100},l.tick(0),await l.renderSensors(),r(c),n(l)})()},[r,n]),j.useEffect(()=>{if(!e.current||!a||!a.canvas||!s||!s.canvas)return;const o=t.lastRender/1e3%8*45*(Math.PI/180);a.position={x:100+50*Math.cos(o),y:100+40*Math.sin(o)},a.angle=o+Math.PI/2,a.tick(0);const c=e.current.getContext("2d",{alpha:!1});s.render(c),a.render(c)},[t.lastRender,e.current,a,s]),i.jsxs(ye,{fixed:!0,children:[i.jsx(T,{children:i.jsx(f,{children:i.jsx("h1",{children:"About: Idle Self Driving"})})}),i.jsx(T,{children:i.jsx(f,{children:i.jsx("p",{children:"This is a simple demonstration of self-driving cars receiving sensory information from their surroundings and controlling their acceleration and steering using a simple neural network."})})}),i.jsxs(T,{children:[i.jsx(f,{size:"4",children:i.jsx("canvas",{ref:e,width:"".concat((s==null?void 0:s.width)||1,"px"),height:"".concat((s==null?void 0:s.height)||1,"px"),style:{margin:"auto",display:"block"}})}),i.jsxs(f,{size:"8",children:[i.jsx("p",{children:"Each car has 5 sensor inputs in front of it. The reading values are between 0 and 1 indicating how far the car is from the edges of the track"}),i.jsx("p",{children:"The network outputs two values between -1 and 1. One for the acceleration of the car (negative means breaking), and the other for steering (negative for left, positive for right)."}),i.jsx("p",{children:"A simple simulation calculates the velocity and the angle of the car. Some basic friction is also calculated for speed and steering, but I didn't bother with drifting or skidding. At least not for now."})]})]}),i.jsx(T,{children:i.jsxs(f,{children:[i.jsx("p",{children:'The cars can "lose" if they hit the edges of the track. There are also some criteria for crossing the finish line in wrong direction or backtracking on the track. There is no collision between the cars, so you can think of this as being in separate tracks or ghosting.'}),i.jsx("p",{children:'A car "wins" if it successfully laps the track 3 times. The scoring is based on the distance travelled and the speed of the car. The faster a car finishes the laps the better it scores. And the further it gets before losing the better it scores.'}),i.jsx("p",{children:"At the beginning of each iteration, 10 new cars are generated based on the global best on the track and the winner of the last track. Some random choices are also made. The further we are in the training, the less random variations there are between cars"}),i.jsxs("p",{children:["The ",i.jsx(q,{icon:Pe})," button will start a new iteration, even if there are still cars racing in the current track. Use the ",i.jsx(q,{icon:De})," button to automatically advance to the next iteration after all cars have finished."]})]})}),i.jsx(T,{children:i.jsxs(f,{children:[i.jsx("p",{children:'You can also change the track the race is taking place on the right side panel. I recommend moving on to the "Advanced" track once you have trained a car that can lap around the "Basic" track. It might take a few more iterations before you have a car that can make the tight corners on the "Advanced" track.'}),i.jsx("p",{children:'There is also an "Oval" track that you can use for fine-tuning the speed of the track navigation, but be mindful that staying on it too long might cause your model to "forget" how to turn left. This is not a commentary on NASCAR™. I promise.'}),i.jsx("p",{children:'Finally, you can put all of the learnings to the test on the "Curvy" track to test both steering abilities and the speed choices of your model.'})]})}),i.jsx(T,{children:i.jsxs(f,{children:["Pro tips:",i.jsxs("ul",{children:[i.jsx("li",{children:'You can save / load / reset the state on the "Settings" tab below. Using import/export features lets you share your models'}),i.jsx("li",{children:"The ability to customize # of sensors, their angles, and ranges are there, but I haven't made the UI for it yet. You can still do it by mocking around in the saved settings, or just get the source code: the link is on top right. Coming later."}),i.jsx("li",{children:"Ability to change the # of layers and neurons in the net is also there, but doesn't have a UI either. You can use the same tricks above to play with it. Or to view your current SOTA."}),i.jsx("li",{children:'If you want your save files in plain text (json) instead of base64, add "?debug" to the end of the URL and you get a bunch of new feature'})]})]})})]})}class Pt extends Le{constructor(){super(...arguments);h(this,"width",200);h(this,"height",200)}get path(){return["M 0 100 h 200"]}get roadThickness(){return 120}get laneMarkingThickness(){return 3}get startingPoint(){return{x:25,y:100}}get startingDirection(){return{x:1,y:0}}}const Se=ct;function Dt({icon:t,src:e,...s}){const r=t||e||"";return r.startsWith("data:")?i.jsx(q,{icon:r,...s}):r.includes("/")||r.includes(".")?i.jsx(q,{src:r,...s}):Se[r]?i.jsx(q,{icon:Se[r],...s}):i.jsx(q,{icon:lt,...s})}function G(){const t=G.useTabs(),e=p.singleton,[s,r]=j.useState(!e.helpDismissed),a=window.location.search||"";return j.useEffect(()=>{e.set({helpDismissed:!s})},[s,r]),i.jsx(Ye,{children:i.jsxs(At,{children:[i.jsxs(Ke,{children:[t.map(n=>i.jsx(Te,{exact:!0,path:"/".concat(n.path),children:i.jsxs(Qe,{children:[i.jsx(Ze,{children:i.jsxs(Xe,{children:[i.jsx(Ve,{slot:"start",children:n.title||n.path}),i.jsxs(Me,{slot:"end",color:"success",children:["© 2025  ",i.jsx("a",{href:"https://github.com/lepouya",target:"_blank",style:{textDecoration:"none"},children:"@lepouya"})]}),i.jsx(Me,{slot:"end",color:"light",children:i.jsx("a",{href:"https://github.com/lepouya/idle-self-driving",target:"_blank",style:{textDecoration:"none"},children:i.jsx("small",{children:"view source"})})})]})}),i.jsx($e,{id:"tab-page",children:n.content}),i.jsx(et,{trigger:s?"tab-page":void 0,isOpen:s,showBackdrop:!0,side:"start",alignment:"start",onDidDismiss:()=>r(!1),children:i.jsxs($e,{class:"ion-padding",children:[i.jsx(Ct,{}),i.jsx(E,{onClick:()=>r(!1),children:"Close"})]})})]})},"tab-".concat(n.path))),t.filter(n=>!!n.from).map(n=>i.jsx(Te,{exact:!0,path:n.from,children:i.jsx(Be,{to:"/".concat(n.path).concat(a)})},"default-tab-".concat(n.path)))]}),i.jsx(tt,{slot:"bottom",children:t.map(n=>(n.icon||n.label)&&i.jsxs(St,{tab:n.path,href:"/".concat(n.path).concat(a),children:[n.icon&&i.jsx(Dt,{"aria-hidden":"true",icon:n.icon}),n.label&&i.jsx(P,{children:n.label})]},"tab-button-".concat(n.path)))})]})})}const ae=oe({});G.register=function(t){ae.get()[t.path]=t,ae.signal()};G.unregister=function(t){delete ae.get()[typeof t=="string"?t:t.path],ae.signal()};G.useTabs=function(){const t=ae.useHook();return Object.values(t)};function S(t,e){return t==null||t==null||typeof t=="string"?S.word(t!=null?t:void 0,e):t instanceof Date?S.time(t.getTime(),e):typeof t=="number"?S.number(t,e):""}S.number=function(t,e){var a,n;const s=(n=(a=Math.log10(Math.abs(t))<3?e==null?void 0:e.smallPrec:e==null?void 0:e.prec)!=null?a:e==null?void 0:e.prec)!=null?n:0;let r=isFinite(t)?t.toFixed(s):t.toString();return r&&(e!=null&&e.alwaysShowSign)&&!"+-".includes(r[0])&&t>=0&&(r="+"+r),r};S.time=function(t,e){var I,m,U,W,O,z;const s=(I=e==null?void 0:e.len)!=null?I:"long",r=((m=e==null?void 0:e.sep)!=null?m:s==="long")?", ":":",a=(e!=null&&e.oxfordComma?r:"")+(((U=e==null?void 0:e.lastSep)!=null?U:s==="long")?" and ":r),n=((W=e==null?void 0:e.now)!=null?W:s==="long")?"now":"",o=((O=e==null?void 0:e.never)!=null?O:s==="long")?"never":"",c=((z=e==null?void 0:e.ago)!=null?z:s==="long")?"ago":"";if(o&&(t<0||(e==null?void 0:e.epoch)!=null&&(e.epoch<=0||t-e.epoch<0)))return o;if(n&&(t===0||(e==null?void 0:e.epoch)!=null&&t===e.epoch))return n;(e==null?void 0:e.epoch)!=null&&(t-=e.epoch);let l=Math.floor(t/1e3),g=Math.floor(t-l*1e3),d=Math.floor(l/60);l-=d*60;let u=Math.floor(d/60);d-=u*60;let k=Math.floor(u/24);u-=k*24;let w=Math.floor(k/365);if(k-=w*365,e!=null&&e.millis||(g=0),n!=null&&k+u+d+l+g===0)return n;let y=[];if(s!=="long"?y=[w>0?w.toFixed(0):"",k>0?k.toFixed(0):"",u>0||s==="short"?u.toFixed(0):"",d>0||s==="short"?d.toFixed(0):"",(l+g/1e3).toFixed(!(e!=null&&e.millis)||s==="tiny"&&g===0?0:3)].map(v=>s==="short"&&(v.length===1||v.indexOf(".")===1)?"0"+v:v):y=[[w,"year"],[k,"day"],[u,"hour"],[d,"minute"],[l,"second",w+k+u+d===0,g]].map(([v,L,N=!1,R=0])=>v>0||R>0||N&&v===0?v.toString()+(R>0?"."+R.toString():"")+" "+L+(v===1?"":"s"):""),y=y.filter(v=>!!v),y.length>2){const v=y.pop();y=[y.join(r),v]}let C=y.join(a)+(c?" "+c:"");return C&&(e!=null&&e.alwaysShowSign)&&t>=0&&s!=="long"&&!"+-".includes(C[0])&&(C="+"+C),C};S.word=function(t,e){var s,r,a,n,o,c;return t||(t=(a=Math.abs(Math.abs((s=e==null?void 0:e.count)!=null?s:0)-1)<=((r=e==null?void 0:e.tolerance)!=null?r:.001)?e==null?void 0:e.singularName:e==null?void 0:e.pluralName)!=null?a:e==null?void 0:e.name),(n=e==null?void 0:e.condition)==null||n?!t&&!((o=e==null?void 0:e.allowEmpties)!=null&&o)?"":(c=e==null?void 0:e.capitalize)==null||c?(t!=null?t:"").replace(/([a-z])([A-Z]|_\S)/g,(l,g,d)=>"".concat(g," ").concat(d.slice(-1))).replace(/(?:^|\s)\w(?=\w)/g,l=>l.toUpperCase()):t!=null?t:"":""};function pe(){var c,l,g;const t=Z(),e=j.useRef(null),s=vt(),r=jt(),a=s[t.currentTrack];j.useEffect(()=>{Y.nextGeneration(a,!1)},[a]),j.useEffect(()=>{var d;if(e.current){const u=e.current.getContext("2d",{alpha:!1});t.renderSensors?(d=r[0])==null||d.renderSensors().then(k=>{u.clearRect(0,0,t.trackWidth,t.trackHeight),u.resetTransform(),u.drawImage(k.canvas,0,0)}):(a.render(u),Y.renderAll(u))}},[t.currentTrack,e.current,t.lastRender]);const n=Math.max(...r.map(d=>d.score.score))||0,o=r.filter(d=>!d.collided).length;return i.jsx(ye,{children:i.jsxs(T,{children:[i.jsx(f,{size:"8",children:i.jsx("canvas",{ref:e,width:"".concat(t.trackWidth,"px"),height:"".concat(t.trackHeight,"px")})}),i.jsxs(f,{size:"4",children:[i.jsxs(B,{children:[i.jsxs(P,{children:["Iteration ",t.numIterations]}),i.jsx(E,{slot:"end",expand:"block",title:"Skip to next iteration",onClick:()=>Y.nextGeneration(a,!0),children:i.jsx(q,{icon:Pe})}),i.jsx(E,{slot:"end",expand:"block",color:t.autoAdvance?"primary":"medium",title:"Toggle auto-advance at the end of each iteration",onClick:()=>t.set({autoAdvance:!t.autoAdvance}),children:i.jsx(q,{icon:De})}),i.jsx(E,{slot:"end",expand:"block",color:t.globalPaused?"medium":"primary",title:t.globalPaused?"Resume":"Pause",onClick:()=>t.set({globalPaused:!t.globalPaused}),children:i.jsx(q,{icon:t.globalPaused?ht:dt})})]}),i.jsxs(B,{children:[i.jsx(P,{children:"Leader Score"}),i.jsx(P,{slot:"end",children:S(n,{prec:2})})]}),i.jsxs(B,{children:[i.jsx(P,{children:"Active Cars"}),i.jsxs(P,{slot:"end",children:[o,"/",r.length]})]}),i.jsx(B,{children:i.jsx(P,{children:" "})}),i.jsx(B,{children:i.jsx(st,{label:"Track Selection",interface:"alert",value:t.currentTrack,onIonChange:d=>{t.set({currentTrack:d.detail.value})},children:Object.keys(s).map(d=>i.jsx(it,{value:d,children:d},d))})}),i.jsxs(B,{children:[i.jsxs(P,{children:["Best Score on ",t.currentTrack," Track"]}),i.jsx(P,{slot:"end",children:S(Math.max(n,((c=t.sotaScore[t.currentTrack])==null?void 0:c.score)||0),{prec:2})})]}),i.jsx(B,{children:i.jsx(P,{children:" "})}),i.jsxs(B,{children:[i.jsx(P,{children:"Simulation Speed"}),i.jsxs(P,{slot:"end",children:[S(((l=t.execution.tick)==null?void 0:l.tps)||0)," tps"]})]}),i.jsxs(B,{children:[i.jsx(P,{children:"Rendering Speed"}),i.jsxs(P,{slot:"end",children:[S(((g=t.execution.tick)==null?void 0:g.fps)||0)," fps"]})]}),i.jsx(B,{children:i.jsx(nt,{checked:t.manualControl,onIonChange:d=>{t.set({manualControl:d.detail.checked}),Y.nextGeneration(a,!1)},children:"Manually Controlled Car"})})]})]})})}pe.init=()=>{G.register({path:"driving",content:i.jsx(pe,{}),icon:"speedometerOutline",label:"Driving",title:"Idle Self Driving",from:"/"})};function ke(){return i.jsxs(ye,{children:[i.jsx(Rt,{}),i.jsx(Et,{}),i.jsx(Ot,{}),i.jsx(zt,{})]})}ke.init=()=>{G.register({path:"settings",content:i.jsx(ke,{}),icon:"settingsOutline",label:"Settings",title:"Settings"})};function Rt(){var r,a,n;const t=Z(),[e,s]=j.useState("");return i.jsxs(he,{children:[i.jsx(de,{children:i.jsx(ge,{children:i.jsx(T,{children:i.jsx(f,{size:"12",className:"ion-text-center",children:i.jsx(ie,{children:"Data"})})})})}),i.jsxs(ue,{children:[i.jsxs(T,{children:[i.jsxs(f,{size:"12",children:["Started"," ",S.time((r=t.lastTick)!=null?r:0,{epoch:t.lastReset})]}),i.jsxs(f,{size:"12",children:["This session started"," ",S.time((a=t.lastTick)!=null?a:0,{epoch:t.lastLoaded})]}),i.jsxs(f,{size:"12",children:["Last saved"," ",S.time((n=t.lastTick)!=null?n:0,{epoch:t.lastSaved})]})]}),i.jsxs(T,{children:[i.jsx(f,{size:"6",children:i.jsx(E,{onClick:()=>{p.load().then(()=>p.save()).then(le)},expand:"block",children:"Load"})}),i.jsx(f,{size:"6",children:i.jsx(E,{onClick:()=>p.save(),expand:"block",children:"Save"})}),i.jsx(f,{size:"6",children:i.jsx(E,{onClick:Nt,expand:"block",children:"Load from File"})}),i.jsx(f,{size:"6",children:i.jsx(E,{onClick:Lt,expand:"block",children:"Save to File"})}),i.jsx(f,{size:"6",children:i.jsx(E,{onClick:()=>{t.load(je(e)),p.save().then(le)},expand:"block",children:"Import Text"})}),i.jsx(f,{size:"6",children:i.jsx(E,{onClick:()=>s(me(t.save(),t.isDebug())),expand:"block",children:"Export Text"})}),i.jsx(f,{size:"12",children:i.jsx(Ce,{label:"Data for import/export",labelPlacement:"floating",fill:"outline",rows:5,autoGrow:!0,value:e,onIonInput:o=>{var c;return s((c=o.detail.value)!=null?c:"")}})})]})]})]})}function Et(){const t=Z(),[e,s]=j.useState(t.ticksPerSec),[r,a]=j.useState(t.rendersPerSec),[n,o]=j.useState(t.saveFrequencySecs);return j.useEffect(()=>{s(t.ticksPerSec)},[t.ticksPerSec]),j.useEffect(()=>{a(t.rendersPerSec)},[t.rendersPerSec]),j.useEffect(()=>{o(t.saveFrequencySecs)},[t.saveFrequencySecs]),i.jsxs(he,{children:[i.jsx(de,{children:i.jsx(ge,{children:i.jsx(T,{children:i.jsx(f,{size:"12",className:"ion-text-center",children:i.jsx(ie,{children:"Advanced Settings"})})})})}),i.jsxs(ue,{children:[i.jsxs(T,{children:[i.jsx(f,{size:"12",children:"If you are having performance issues, increase the time between updates. Faster updating frequncies lead to better experience but might use a lot of CPU."}),i.jsx(f,{size:"6",className:"ion-text-right",children:"Updating frequency:"}),i.jsxs(f,{size:"6",className:"ion-text-center",children:[Math.floor(1e3/t.ticksPerSec),"ms"]}),i.jsx(f,{size:"6"}),i.jsx(f,{size:"6",children:i.jsx(xe,{min:6,max:100,step:1,pin:!0,pinFormatter:c=>"".concat(Math.floor(1e3/c),"ms"),value:e,onIonInput:c=>s(c.detail.value),onIonChange:c=>{t.set({ticksPerSec:c.detail.value})},className:"ion-no-padding"})}),i.jsx(f,{size:"6",className:"ion-text-right",children:"Rendering frequency:"}),i.jsxs(f,{size:"6",className:"ion-text-center",children:[Math.floor(1e3/t.rendersPerSec),"ms"]}),i.jsx(f,{size:"6"}),i.jsx(f,{size:"6",children:i.jsx(xe,{min:1,max:60,step:1,pin:!0,pinFormatter:c=>"".concat(Math.floor(1e3/c),"ms"),value:r,onIonInput:c=>a(c.detail.value),onIonChange:c=>{t.set({rendersPerSec:c.detail.value})},className:"ion-no-padding"})})]}),i.jsxs(T,{children:[i.jsx(f,{size:"12",children:"Change how often the session is saved in the background. More frequent saving leads to faster backups, but increases CPU and I/O usage"}),i.jsx(f,{size:"6",className:"ion-text-right",children:"Saving frequency:"}),i.jsx(f,{size:"6",className:"ion-text-center",children:S.time(1e3*t.saveFrequencySecs,{ago:""})}),i.jsx(f,{size:"6"}),i.jsx(f,{size:"6",children:i.jsx(xe,{min:1,max:60,step:1,pin:!0,pinFormatter:c=>S.time(1e3*(600/c),{ago:"",len:"tiny"}).replace(":","m:")+"s",value:600/n,onIonInput:c=>o(600/c.detail.value),onIonChange:c=>{t.set({saveFrequencySecs:600/c.detail.value})},className:"ion-no-padding"})})]})]})]})}function Ot(){const[t,e]=j.useState(!1);function s(){t&&(e(!1),p.reset(),D.clear().then(le))}return i.jsxs(he,{children:[i.jsx(de,{children:i.jsx(ge,{children:i.jsx(T,{children:i.jsx(f,{size:"12",className:"ion-text-center",children:i.jsx(ie,{children:"Reset"})})})})}),i.jsx(ue,{children:i.jsxs(T,{children:[i.jsx(f,{size:"12",children:i.jsx(ie,{color:"danger",children:"WARNING: this will completely reset your settings and delete all saved progress. Only use this if you want to restart from the beginning, or if something in the settings is so messed up that it is unusable."})}),i.jsx(f,{size:"12",children:i.jsx(rt,{justify:"end",checked:t,onIonChange:()=>e(r=>!r),children:"I understand what this means and still want to reset"})}),i.jsx(f,{size:"12",class:"ion-text-right",children:i.jsx(E,{onClick:s,disabled:!t,color:t?"danger":"medium",children:"Reset everything"})})]})})]})}function zt(){const t=Z();return t.isDebug()&&i.jsxs(he,{children:[i.jsx(de,{children:i.jsx(ge,{children:i.jsx(T,{children:i.jsx(f,{size:"12",className:"ion-text-center",children:i.jsx(ie,{children:"Debug Context"})})})})}),i.jsx(ue,{children:i.jsx(T,{children:i.jsx(f,{size:"12",children:i.jsx(Ce,{autoGrow:!0,readonly:!0,value:me(t,!0)})})})})]})}function Lt(){const t=p.singleton,e="idle-self-driving".replace(/\W/g,"_"),s="0.9.0".replace(/\W/g,"_"),r=new Date().toISOString().replace(/\D/g," ").trim().replace(/\D/g,"-"),a="".concat(e,"-v").concat(s,"-").concat(r),n=me(t.save(),t.isDebug()),o=new Blob([n],{type:"text/plain"}),c=URL.createObjectURL(o),l=document.createElement("a");l.href=c,l.download=a,l.click(),URL.revokeObjectURL(c)}function Nt(){const t=document.createElement("input");t.type="file",t.addEventListener("change",function(e){const s=e.target.files;if(!s||s.length===0||!s[0])return;const r=new FileReader;r.onload=function(a){var c;const n=(c=a.target)==null?void 0:c.result;if(!n||typeof n!="string")return;const o=p.singleton;o.load(je(n)),o.tick(void 0,"load"),p.save().then(le)},r.readAsText(s[0])},!1),t.click()}function le(){at().push("/"),window.location.reload()}function we(){const t=Z();return j.useEffect(()=>(A.addEventListeners(),D.initialize(),()=>A.removeEventListeners()),[]),j.useEffect(()=>(p.addTickTimer(),()=>p.removeTickTimer()),[t.ticksPerSec]),null}we.initialize=async function(){await D.initialize(),pe.init(),ke.init(),await p.load(),await Promise.all([Le.loadAll(),b.loadAll()])};ot();window.addEventListener("load",async()=>{const t=document.createElement("div");t.id="root",document.body.appendChild(t);const e=Ue.createRoot(t);await we.initialize(),e.render(i.jsx(j.StrictMode,{children:i.jsxs($t,{children:[i.jsx(we,{}),i.jsx(G,{})]})}))},!1);export{Bt as __vite_legacy_guard};
