var Ce=Object.defineProperty;var Pe=(t,e,s)=>e in t?Ce(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var d=(t,e,s)=>Pe(t,typeof e!="symbol"?e+"":e,s);import{r as j,j as i,c as pe,e as De,f as Re}from"./react-BcdRWP67.js";import{u as Ee,f as Oe,S as ze,I as Le,j as Ne,k as Fe,m as fe,n as I,o as f,q as z,r as Be,s as Ue,t as We,v as qe,w as He,x as Ge,y as ke,z as we,A as _e,B as P,C as Je,D as S,E,F as Ye,G as Ke,J as Qe,K as ne,L as re,M as ae,N as Z,O as oe,P as ve,Q as he,R as Ze,T as Xe,U as Ve}from"./ionic-BykuDuUS.js";import{p as be,r as Ie,I as et,b as tt,a as st,c as it}from"./ionicons-BRXXFa2O.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function s(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(a){if(a.ep)return;a.ep=!0;const r=s(a);fetch(a.href,r)}})();function T(t=0,e=0,s=1){return isNaN(t)||t<e?e:t>s?s:t}class nt extends Error{}class ye extends Error{}class rt{constructor(e,s){d(this,"canvas");d(this,"options");this.canvas=e,this.options=s}get dataURL(){return this.canvas.toDataURL(this.options.format,this.options.quality)}get blob(){return new Promise((e,s)=>this.canvas.toBlob(n=>n?e(n):s(new ye),this.options.format,this.options.quality))}getPixels(e,s,n,a){var x,w;const r=this.canvas.width,o=this.canvas.height,l=se(e,0,r-1),c=se(s,0,o-1),h=se(n,1,r-l),g=se(a,1,o-c),u=(w=(x=this.canvas)==null?void 0:x.getContext("2d",{alpha:!1}))==null?void 0:w.getImageData(l,c,h,g);if(!u)throw new ye;return{buffer:new Uint32Array(u.data.buffer),startX:l-e,startY:c-s,width:h,height:g}}}async function Q(t,e){var l;const s=Object.assign({},ot,e),n=[...t||[],...(s==null?void 0:s.sources)||[]],a=await Promise.all(n.map(c=>at(c,s)));let r=s.reuse instanceof HTMLCanvasElement?s.reuse:(l=s.reuse)==null?void 0:l.canvas;r||(r=window.document.createElement("canvas")),r.width=s.width||Math.max(...a.map(([c])=>c.width)),r.height=s.height||Math.max(...a.map(([c])=>c.height)),r.className=[...Array.isArray(s.className)?s.className:[s.className],"composed-image"].join(" "),s.style&&Object.assign(r.style,s.style);const o=r.getContext("2d");s.clear&&o.clearRect(0,0,r.width,r.height);for(let[c,h]of a){o.save();let g=M(h.crop,0,"x")||0,u=M(h.crop,1,"y")||0,k=M(h.crop,2,"w")||c.width,x=M(h.crop,3,"h")||c.height,w=M(h.position,0,"x")||0,b=M(h.position,1,"y")||0,y=(M(h.stretch,0,"sx")||1)*k,D=(M(h.stretch,1,"sy")||1)*x,N=(M(h.rotate,2,"a")||0)*(Math.PI/180),O=typeof h.rotate=="number"?void 0:h.rotate,_=(M(O,0,"x")??.5)*y+w,J=(M(O,1,"y")??.5)*D+b,Y=M(h.scale,2,"sx")??1,K=M(h.scale,3,"sy")??1,m=typeof h.scale=="number"?void 0:h.scale,R=(M(m,0,"x")??.5)*y+w,xe=(M(m,1,"y")??.5)*D+b;o.globalAlpha=h.opacity??1,o.globalCompositeOperation=h.composition??"source-over",o.imageSmoothingEnabled=h.smoothing!==!1&&h.smoothing!=="disabled",o.imageSmoothingQuality=h.smoothing==="medium"||h.smoothing==="high"?h.smoothing:"low",Array.isArray(h.filter)?o.filter=h.filter.join(" "):h.filter&&(o.filter=h.filter),o.filter||(o.filter="none"),o.resetTransform(),N!==0&&(o.translate(_,J),o.rotate(N),o.translate(-_,-J)),(Y!==1||K!==1)&&(o.translate(R,xe),o.scale(Y,K),o.translate(-R,-xe)),o.imageSmoothingEnabled||(g=~~g,u=~~u,k=~~k,x=~~x,w=~~w,b=~~b,y=~~y,D=~~D),o.drawImage(c,g,u,k,x,w,b,y,D),o.restore()}return new rt(r,s)}function at(t,e){return new Promise((s,n)=>{var o,l,c,h;const a=typeof t=="string"?{src:t}:t;a.src=(a.src||"").trim(),!a.src||a.src==="transparent"?a.src=ct:a.src.startsWith("plain:")?a.src=lt.replace("{color}",encodeURIComponent(a.src.slice(6).trim())).replace("{width}",((o=e==null?void 0:e.width)==null?void 0:o.toString())||"100%").replace("{height}",((l=e==null?void 0:e.height)==null?void 0:l.toString())||"100%"):a.src.startsWith("<svg")&&(a.src.includes("xmlns=")||(a.src=a.src.replace("<svg",'<svg xmlns="http://www.w3.org/2000/svg"')),a.src="data:image/svg+xml;utf8,"+encodeURIComponent(a.src.replace("{width}",((c=e==null?void 0:e.width)==null?void 0:c.toString())||"100%").replace("{height}",((h=e==null?void 0:e.height)==null?void 0:h.toString())||"100%")));const r=new Image;r.onerror=()=>n(new nt),r.onload=()=>s([r,a]),r.crossOrigin="anonymous",r.src=a.src})}const ot={format:"image/png",quality:.92},ct="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",lt='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1 1" preserveAspectRatio="none"     width="{width}" height="{height}">  <rect x="0" y="0" width="1" height="1" fill="{color}" /></svg>';function M(t,...e){let s;if(!t||typeof t=="number")s=t??void 0;else if(Array.isArray(t)){for(let n of e)if(typeof n=="string"&&(n=parseInt(n)),typeof n=="number"&&isFinite(n)){const a=t[n];if(a!=null&&typeof a=="number"){s=a;break}}}else if(typeof t=="object"){for(let n of e)if(typeof n=="string"||typeof n=="number"){const a=t[n];if(a!=null&&typeof a=="number"){s=a;break}}}for(let n of e)n&&typeof n=="object"&&(n.def!=null&&s==null&&(s=n.def),n.min!=null&&s!=null&&(s=Math.max(s,n.min)),n.max!=null&&s!=null&&(s=Math.min(s,n.max)));return s}function se(t=0,e=0,s=1){return isNaN(t)||t<e?~~e:t>s?~~s:~~t}function te(t){const e={};function s(){return typeof t=="function"?t():t}function n(){return Date.now().toString(36)+Math.random().toString(36).slice(1)}function a(h,g){const u=g||n();return e[u]=h,u}function r(h){delete e[h]}function o(){return e}function l(){const h={ref:s()};Object.values(e).forEach(g=>g(h))}function c(){const[h,g]=j.useState(n),[u,k]=j.useState(()=>({ref:s()}));return j.useEffect(()=>{const x=a(k,h);return g(x),()=>{r(h),r(x)}},[h]),Ee(()=>{const x=a(k,h);g(x)},[h]),Oe(()=>{r(h)},[h]),u.ref}return{useHook:c,signal:l,register:a,unregister:r,getRegistry:o,get:s}}function ce(t){if(ce.skipEncoding||!t)return t;const e=t.startsWith(".."),s=(e?t:Math.random().toString(36)).substring(2,10);return(e?"":".."+s)+(e?t.slice(10):t).split("").map(n=>n.charCodeAt(0)).map((n,a)=>String.fromCharCode(n^s.charCodeAt(a%8))).join("")}ce.skipEncoding=!1;function ht(t,e){const s=[];function n(a,r){if(!(a&&a.startsWith("_")))return!r||typeof r!="object"||Array.isArray(r)?r:r instanceof Date?r.toJSON():Object.keys(r).length===0||s.includes(r)?void 0:(s.push(r),r)}return JSON.stringify(t,n,e)}function le(t,e=!1){const s=ht(t,e?2:void 0);return e?s:window.btoa(ce(encodeURIComponent(s)))}function me(t){if(!t||typeof t!="string")return t??void 0;try{const e=JSON.parse(decodeURIComponent(ce(window.atob(t))));if(e)return e}catch{}try{const e=JSON.parse(t);if(e)return e}catch{}return t}const B={db:void 0};function C(){return C.initialize(),B.db}C.initialize=async function(){return B.db||(B.db=new ze,B.db=await B.db.create()),B.db};C.write=async function(t,e,s=!1){const n=le(e,s),a=await C.initialize();return await(a==null?void 0:a.set(t,n))};C.read=async function(t){const e=await C.initialize(),s=await(e==null?void 0:e.get(t));return me(s)};C.clear=async function(){const t=await C.initialize();await(t==null?void 0:t.clear())};function $(t,e){$.register(t,e)}$.register=function(t,e){t=t.toLowerCase().replace(/\W/g,""),U[t]??(U[t]=[]),U[t].includes(e)||U[t].push(e)};$.addEventListeners=function(){document.addEventListener("keydown",Te),document.addEventListener("keyup",Me),$e()};$.removeEventListeners=function(){document.removeEventListener("keydown",Te),document.removeEventListener("keyup",Me),$e()};$.test=function(t){return X[t.toLowerCase().replace(/\W/g,"")]??!1};$.some=function(...t){return t.some($.test)};$.all=function(...t){return t.every($.test)};const dt=["TEXTAREA","INPUT"],U={},X={};function Te(t){if(Ae(t.target))return;const e=t.key.toLowerCase().replace(/\W/g,"");X[e]=!0;const s=U[e];s&&s.length>0&&s.forEach(n=>{n(t)&&(t.preventDefault(),t.stopPropagation())})}function Me(t){if(Ae(t.target))return;const e=t.key.toLowerCase().replace(/\W/g,"");X[e]=!1}function $e(){Object.keys(X).forEach(t=>X[t]=!1)}function Ae(t){try{return t&&dt.includes(t.tagName.toUpperCase())}catch{return!1}}function gt(t=0,e=1){const s=1-Math.random(),n=Math.random();return Math.sqrt(-2*Math.log(s))*Math.cos(2*Math.PI*n)*e+t}class V{constructor(e){this.config=e,this.validate(),this.regularize()}static init(e,s,n){if(!e)throw new Error("Invalid input count");if(!s)throw new Error("Invalid output count");n||(n=[]);const a=[];for(let r=0;r<n.length+1;r++){const o=r===0?e:n[r-1],l=r===n.length?s:n[r],c=[];for(let h=0;h<l;h++){const g=[];for(let u=0;u<o+1;u++)g.push(0);c.push(g)}a.push(c)}return new V({input:e,output:s,hidden:n,weights:a})}validate(){const{input:e,hidden:s,output:n,weights:a}=this.config;if(e<1)throw new Error("Invalid input count");if(s.length<0)throw new Error("Invalid hidden layer count");if(n<1)throw new Error("Invalid output count");if(a.length!==s.length+1)throw new Error("Invalid weight count");for(let r=0;r<a.length;r++){const o=r===0?e:s[r-1],l=r===s.length?n:s[r];if(a[r].length!==l)throw new Error(`Invalid row count for weights layer ${r}`);for(let c=0;c<a[r].length;c++)if(a[r][c].length!==o+1)throw new Error(`Invalid col count for weights layer ${r} neuron ${c}`)}}regularize(){const e=this.config.weights,s=2;for(let n=0;n<e.length;n++)for(let a=0;a<e[n].length;a++)for(let r=0;r<e[n][a].length;r++)e[n][a][r]=T(e[n][a][r],-2,s)}eval(e){const s=this.config.weights;let n=e;for(let a=0;a<s.length;a++){let r=[];for(let o=0;o<s[a].length;o++){let l=s[a][o][n.length-1];for(let c=0;c<n.length-1;c++)l+=n[c]*s[a][o][c];r.push(this.activation(l))}n=r}return n}activation(e){return e<-1?-1:e>1?1:e}randomStep(e){return new V({...this.config,weights:this.config.weights.map(s=>s.map(n=>n.map(a=>gt(a,e))))})}}class H{constructor(e,s="",n=.5,a=!0){d(this,"renderImage");d(this,"sensorImage");d(this,"width",p.singleton.carWidth);d(this,"height",p.singleton.carHeight);d(this,"track",null);d(this,"position",{x:0,y:0});d(this,"angle",0);d(this,"speed",0);d(this,"steering",0);d(this,"acceleration",0);d(this,"odometer",0);d(this,"laps",0);d(this,"inCrossing",!1);d(this,"totalTicks",0);d(this,"startTime",0);d(this,"endTime",0);d(this,"collided",!1);d(this,"pastTracking",[]);d(this,"sensorsReady",!0);d(this,"sensorReadingTime",0);d(this,"sensorReadings",[]);d(this,"visualizeSensors",!1);d(this,"net",null);if(this.name=e,this.color=s,this.fudgeFactor=n,!s){const r=[32,64,128].map(o=>T(~~(Math.random()*o*2),0,255));this.color="#"+r.map(o=>o.toString(16).padStart(2,"0")).join("")}e&&a&&(H.registry.get()[e]=this)}get mask(){return[`<svg
        width="${this.width}px"
        height="${this.height}px"
        viewBox="0 0 ${this.width} ${this.height}"
      >`,`<rect
        width="${this.width}"
        height="${this.height}"
        rx="${this.width/4}"
        ry="${this.height/4}"
        fill="${v.color.vehicle}"
        shape-rendering="crispEdges"
      />`,"</svg>"].join("")}get image(){return[`<svg
        width="${this.width}px"
        height="${this.height}px"
        viewBox="0 0 ${this.width} ${this.height}"
      >`,`<rect
        width="${this.width}"
        height="${this.height}"
        rx="${this.width/4}"
        ry="${this.height/4}"
        fill="${this.laps>=3?"green":this.collided?"red":this.color}"
      />`,[[0,0],[this.width*3/4,0],[this.width*3/4,this.height*3/4],[0,this.height*3/4]].map(([e,s])=>`<rect
            x="${e}"
            y="${s}"
            width="${this.width/4}"
            height="${this.height/4}"
            rx="${this.width/8}"
            ry="${this.height/8}"
            fill="black"
          />`),"</svg>"].join("")}get canvas(){var e;return(e=this.renderImage)==null?void 0:e.canvas}async fetchImageData(){return this.renderImage=await Q([],{reuse:this.renderImage,clear:!0,sources:[{src:this.image,opacity:this.net?.666:1}],width:this.width,height:this.height}),this.renderImage}get score(){const e=Date.now(),s=this.odometer/Math.max(this.width,this.height),n=((this.endTime||e)-(this.startTime||e))/1e3;return{distance:s,time:n,laps:this.laps,success:!this.collided&&this.laps>=3&&this.startTime>0,score:this.startTime>0?Math.max(0,s-n)+(this.laps+1)**2*10:0}}placeOnTrack(e){this.track=e,this.position.x=e.startingPoint.x,this.position.y=e.startingPoint.y,this.angle=e.startingAngle,this.speed=0,this.steering=0,this.acceleration=0,this.position.x-=e.startingDirection.x*this.width/2,this.position.y-=e.startingDirection.y*this.height/2;const s=this.net?Math.random()*e.roadThickness-e.roadThickness/2:0;this.position.x+=s*this.fudgeFactor*e.startingDirection.y,this.position.y-=s*this.fudgeFactor*e.startingDirection.x,this.odometer=0,this.laps=0,this.inCrossing=!1,this.startTime=0,this.endTime=0,this.collided=!1,this.fetchImageData();const n=Math.max(this.width,this.height,this.track.roadThickness)+1;this.pastTracking=[{x:e.startingPoint.x-e.startingDirection.x*n,y:e.startingPoint.y-e.startingDirection.y*n}],this.sensorsReady=!0,this.sensorReadingTime=Date.now()}endRun(e=!0){var n;this.endTime=Date.now(),this.startTime||(this.startTime=this.endTime),this.inCrossing=!1,this.collided=e,this.fetchImageData();const s=p.singleton;this.track&&this.net&&this.score.score>(((n=s.sotaScore[this.track.name])==null?void 0:n.score)??0)&&(s.sotaNet=this.net.config,s.sotaScore={[this.track.name]:this.score})}render(e,s=!1){if(this.canvas){if(e.save(),e.resetTransform(),e.translate(~~this.position.x,~~this.position.y),e.rotate(this.angle),(this.visualizeSensors||this.name==="Manual")&&v.registry.get().forEach((n,a)=>n.render(e,this.sensorReadings[a])),e.drawImage(this.canvas,~~(-this.width/2),~~(-this.height/2)),s){const n=Math.abs(Math.sin(Date.now()/200)+1);e.filter=`blur(${n*5}px) brightness(${n*100}%)`,e.drawImage(this.canvas,~~(-this.width/2),~~(-this.height/2))}e.restore()}}tick(e){if(this.collided||!this.track)return;if(this.name==="Manual")this.manualControl();else{const r=this.score;if(r.score<-10||this.totalTicks>3&&r.laps===0&&r.score<=r.time)return console.log(this.name,"doesn't seem to be going anywhere"),this.endRun();if(r.laps>=3)return this.endRun()}const s=p.singleton;if(this.totalTicks+=e,this.steering=T(this.steering,-1,1),this.steering=T(this.steering,-this.speed,this.speed),Math.abs(this.steering)>=.01&&(this.angle+=s.maxSteering*this.steering*e,this.steering-=s.friction*Math.sign(this.steering)*e,this.speed-=s.friction*this.speed*e),this.angle>Math.PI?this.angle-=Math.PI*2:this.angle<-Math.PI&&(this.angle+=Math.PI*2),this.acceleration=T(this.acceleration,-1,1),Math.abs(this.acceleration)>=.01?(this.speed+=s.maxAcceleration*this.acceleration*e,this.acceleration-=s.friction*Math.sign(this.acceleration)*e):this.speed-=s.friction*this.speed*e,this.speed=T(this.speed,0,s.maxSpeed),this.position.x+=Math.cos(this.angle)*this.speed*e,this.position.y+=Math.sin(this.angle)*this.speed*e,this.odometer+=this.speed*e,this.position.x<=0||this.position.x>=this.track.width||this.position.y<=0||this.position.y>=this.track.height)return console.log(this.name,"went out of bounds"),this.endRun();const n=Math.max(this.width,this.height,this.track.roadThickness),a=this.pastTracking.map(r=>Math.hypot(r.x-this.position.x,r.y-this.position.y));if(a.length===0||a.every(r=>r>n))this.pastTracking.unshift({x:this.position.x,y:this.position.y}),this.pastTracking.length>3&&this.pastTracking.pop();else if(a.length>1&&a.slice(1).some(r=>r<n))return console.log(this.name,"went back on the track"),this.endRun();this.checkSensors()}async renderSensors(){var e;return Q([],{width:p.singleton.trackWidth,height:p.singleton.trackHeight,sources:[{src:((e=this.track)==null?void 0:e.mask)||"transparent",smoothing:!1},{src:this.mask,position:{x:this.position.x-this.width/2,y:this.position.y-this.height/2},rotate:this.angle*(180/Math.PI),composition:"lighter",smoothing:!1},...v.registry.get().map(s=>({src:s.mask,position:{x:this.position.x-s.range,y:this.position.y-s.range},rotate:this.angle*(180/Math.PI),composition:"lighter",smoothing:!1}))]})}checkSensors(){if(!(!this.track||this.collided)&&!(!this.sensorsReady&&Date.now()-this.sensorReadingTime<100))return this.sensorsReady=!1,Q([],{width:this.track.width,height:this.track.height,reuse:this.sensorImage,clear:!0,sources:[{src:this.track.mask,smoothing:!1},{src:this.mask,position:{x:this.position.x-this.width/2,y:this.position.y-this.height/2},rotate:this.angle*(180/Math.PI),composition:"lighter",smoothing:!1}]}).then(e=>{if(this.sensorImage=e,this.checkCollision(e))return this.endRun();if(this.sensorReadings=v.readAll(e,this.position.x,this.position.y,this.angle),this.net){const n=this.net.eval([...this.sensorReadings,this.acceleration,this.steering,this.speed/p.singleton.maxSpeed,this.angle/Math.PI]);this.acceleration=n[0],this.steering=n[1]}}).catch(e=>{console.error("Error reading sensors",this.name,e)}).finally(()=>{this.sensorsReady=!0,this.sensorReadingTime=Date.now()})}checkCollision(e){const s=~~Math.max(this.width/2,this.height/2)+1,n=e.getPixels(this.position.x-s,this.position.y-s,s*2,s*2).buffer,a=n.some(h=>v.check(h,v.vehicle,v.lapLine)),r=n.some(h=>v.check(h,v.vehicle,v.offTrack)),o=this.angle,l=this.track.startingAngle;let c=Math.abs((o<0?o+Math.PI*2:o)-(l<0?l+Math.PI*2:l));if(c>Math.PI&&(c=Math.PI*2-c),a&&!this.inCrossing){if(this.inCrossing=!0,c>Math.PI/2)return console.log(this.name,"crossed the lap line the wrong way"),!0;if(!this.startTime)this.startTime=Date.now();else{if(this.odometer<this.width+this.height)return console.log(this.name,"didn't complete a full lap"),!0;this.laps++,console.log(this.name,"has completeted lap",this.laps,this.score.score)}}else if(!a&&this.inCrossing&&(this.inCrossing=!1,c>Math.PI/2))return console.log(this.name,"turned around on the lap line"),!0;return r?(console.log(this.name,"went off track"),!0):!1}manualControl(){$.some("ArrowDown","S")?this.acceleration=T(this.acceleration-.1,-1,-.1):$.some("ArrowUp","W")?this.acceleration=T(this.acceleration+.1,.1,1):this.acceleration=0,$.some("ArrowLeft","A")?this.steering=T(this.steering-.1,-1,-.1):$.some("ArrowRight","D")?this.steering=T(this.steering+.1,.1,1):this.steering=0}}(t=>{t.registry=te({});function e(r){Object.values(t.registry.get()).sort((l,c)=>c.score.score-l.score.score).forEach((l,c)=>l.render(r,c===0))}t.renderAll=e;function s(r){var o;if(Object.values(t.registry.get()).forEach(l=>l.tick(r)),p.singleton.autoAdvance){const l=Object.values(t.registry.get());if(l.every(c=>c.collided||c.name==="Manual")){const c=(o=l[0])==null?void 0:o.track;c&&n(c,!1)}}}t.tickAll=s;async function n(r,o=!1){var D,N,O,_,J,Y,K;const l=p.singleton,c=t.registry.get();l.manualControl&&(!c.Manual||(((D=c.Manual)==null?void 0:D.collided)??!0)||(((O=(N=c.Manual)==null?void 0:N.track)==null?void 0:O.name)??"")!==r.name)?new t("Manual","#33eeee").placeOnTrack(r):!l.manualControl&&c.Manual&&delete c.Manual;const h=Object.values(c).filter(m=>m.name!=="Manual"&&m.net);if(!o&&h.some(m=>!m.collided&&m.track===r))return;h.forEach(m=>m.endRun()),h.sort((m,R)=>R.score.score-m.score.score);const g=new V(l.sotaNet),u=l.sotaScore[r.name],k=((_=h[0])==null?void 0:_.net)??g,x=((J=h[0])==null?void 0:J.score)??u,w=Math.floor(Math.random()*h.length),b=((Y=h[w])==null?void 0:Y.net)??k,y=((K=h[w])==null?void 0:K.score)??x;for(let m=0;m<l.numSimulations.globalBest;m++){const R=new t(`AI.globalBest.${m}`);R.net=g.randomStep(m===0?0:a(u))}for(let m=0;m<l.numSimulations.trackBest;m++){const R=new t(`AI.trackBest.${m}`);R.net=k.randomStep(m===0&&(x==null?void 0:x.score)!==(u==null?void 0:u.score)?0:a(x))}for(let m=0;m<l.numSimulations.trackRandom;m++){const R=new t(`AI.trackRandom.${m}`);R.net=b.randomStep(a(y))}l.numIterations++,console.log("Starting iteration",l.numIterations),Object.values(c).forEach(m=>{m.track||m.placeOnTrack(r)}),await Promise.all(Object.values(c).map(m=>m.fetchImageData())),p.save(),t.registry.signal()}t.nextGeneration=n;function a(r){return!r||!r.score||!r.distance||!r.time?1:T(Math.sqrt(10/r.score),.1,1)}})(H||(H={}));function ut(){const t=H.registry.useHook();return Object.values(t)}const W=H,q=class q{constructor(e){d(this,"ticksPerSec",100);d(this,"rendersPerSec",30);d(this,"saveFrequencySecs",60);d(this,"minUpdateSecs",.01);d(this,"maxUpdateSecs",.25);d(this,"maxTickSecs",.1);d(this,"globalTimeDilation",1);d(this,"globalPaused",!1);d(this,"lastReset",Date.now());d(this,"lastSaved",0);d(this,"lastLoaded",Date.now());d(this,"lastRender",0);d(this,"lastTick");d(this,"onTickComplete");d(this,"execution",{});d(this,"helpDismissed");d(this,"trackWidth",800);d(this,"trackHeight",600);d(this,"currentTrack","Basic");d(this,"autoAdvance",!1);d(this,"carWidth",20);d(this,"carHeight",15);d(this,"friction",.1);d(this,"maxSpeed",100);d(this,"maxAcceleration",25);d(this,"maxSteering",Math.PI/2);d(this,"manualControl",!1);d(this,"renderSensors",!1);d(this,"sensors",[{range:100,angle:0},{range:100,angle:Math.PI/6},{range:100,angle:-Math.PI/6},{range:100,angle:Math.PI/3},{range:100,angle:-Math.PI/3}]);d(this,"numIterations",0);d(this,"numSimulations",{globalBest:4,trackBest:4,trackRandom:2});d(this,"sotaScore",{});d(this,"sotaNet",V.init(this.sensors.length+4,2,[]).config);this.load(e),q.singleton=this}isDebug(){return window.location.search.toLowerCase().includes("debug")}set(e){let s;for(s in e)e[s]==null||e[s]==null||(typeof this[s]=="object"&&typeof e[s]=="object"?Object.assign(this[s],e[s]):this[s]=e[s]);return q.registry.signal(),this}load(e){if(e){if(typeof e=="string")return this.load(JSON.parse(e))}else return this;return this.set(e),this.lastLoaded=Date.now(),this}save(){return this.lastSaved=Date.now(),this}tick(e=Date.now(),s="unknown",n,a){var u,k;const r=this.lastTick??e;let o=T((e-r)/1e3,0,this.maxUpdateSecs);if(o<this.minUpdateSecs&&this.lastTick!=null)return[];this.lastTick=e;const l=e-o*1e3,c={},h=1/this.globalTimeDilation,g=[o,1];for(;o>0;){const x=T(o,this.minUpdateSecs,this.maxTickSecs);o-=x,s==="tick"&&W.tickAll(this.globalPaused?0:x*h)}return this.execution[s]={lastTick:e,lastDelta:(e-l)/1e3,lastResult:Object.values(c).flat().filter((x,w,b)=>b.indexOf(x)===w),tps:(((u=this.execution[s])==null?void 0:u.tps)||0)*.8+g[1]/g[0]*.2,fps:((k=this.execution[s])==null?void 0:k.fps)||0},this.onTickComplete&&this.onTickComplete((e-l)/1e3,s),n&&this.lastTick-this.lastSaved>=this.saveFrequencySecs*1e3&&this.lastTick-this.lastLoaded>=this.saveFrequencySecs*1e3&&(this.lastSaved=this.lastTick,n(this)),a&&this.lastTick-this.lastRender>=1e3/this.rendersPerSec&&(this.execution[s].fps=(this.execution[s].fps||0)*.8+1e3/(this.lastTick-this.lastRender)*.2,this.lastRender=this.lastTick,a(this)),this.execution[s].lastResult}};d(q,"singleton",new q);let p=q;(t=>{t.registry=te(()=>t.singleton);async function e(){t.singleton.tick(void 0,"save");const c=await C.write("Settings",t.singleton.save());return t.registry.signal(),c}t.save=e;async function s(){return t.singleton.load(await C.read("Settings")),t.singleton.tick(void 0,"load"),t.registry.signal(),t.singleton}t.load=s;function n(c){return t.singleton=new t(c),t.registry.signal(),t.singleton}t.reset=n;function a(c,h){return t.singleton.tick(c,h,e,t.registry.signal)}t.tick=a;const r=[];function o(){l();const c=setInterval(()=>a(void 0,"tick"),1e3/t.singleton.ticksPerSec);r.push(c)}t.addTickTimer=o;function l(){r.forEach(c=>clearInterval(c)),r.length=0}t.removeTickTimer=l})(p||(p={}));function G(){return p.registry.useHook()}class v{constructor(e,s){d(this,"renderImage");d(this,"path");this.range=e,this.angle=s;const n=e*Math.cos(s),a=e*Math.sin(s);this.path=`M ${~~e} ${~~e} l ${~~n} ${~~a}`}get maskColor(){return v.radar}get mask(){return[`<svg
        width="${this.range*2}px"
        height="${this.range*2}px"
        viewBox="0 0 ${this.range*2} ${this.range*2}"
      >`,`<path
        d="${this.path}"
        stroke="${v.color.radar}"
        stroke-width="2px"
        stroke-linecap="butt"
        fill="none"
        shape-rendering="crispEdges"
      />`,"</svg>"].join("")}get image(){return[`<svg
        width="${this.range*2}px"
        height="${this.range*2}px"
        viewBox="0 0 ${this.range*2} ${this.range*2}"
      >`,`<path
        d="${this.path}"
        stroke="green"
        stroke-width="2px"
        stroke-linecap="round"
        fill="none"
      />`,"</svg>"].join("")}get canvas(){var e;return(e=this.renderImage)==null?void 0:e.canvas}async fetchImageData(){return this.renderImage=await Q([this.image],{reuse:this.renderImage,clear:!0,width:this.range*2,height:this.range*2}),this.renderImage}render(e,s=1){if(!this.canvas)return;const n=~~this.range,a=~~(this.range*s);e.globalCompositeOperation="lighter",e.drawImage(this.canvas,-n,-n,n*2,n*2),e.globalCompositeOperation="source-over",e.drawImage(this.canvas,-a,-a,a*2,a*2)}read(e,s,n,a,r,o){const l=Math.cos(this.angle+o),c=Math.sin(this.angle+o);let h=0;for(let g=0;g<this.range;g++){const u=T(~~(r+g*c),0,n-1),k=T(~~(a+g*l),0,s-1);if(v.check(e[u*s+k],v.offTrack))break;h=g}return T(h/this.range,0,1)}}(t=>{t.available=0,t.offTrack=8388608,t.lapLine=32768,t.vehicle=8355711,t.radar=128,t.color={available:e(t.available),offTrack:e(t.offTrack),lapLine:e(t.lapLine),vehicle:e(t.vehicle),radar:e(t.radar)};function e(o){return"#"+o.toString(16).padStart(6,"0")}function s(o){return(o&16711680)>>16|(o&255)<<16|o&65280}function n(o,...l){const c=s(l.reduce((h,g)=>h|g,0));return(o&c)===c}t.check=n,t.registry=te([]);async function a(){const o=p.singleton.sensors.map(({range:l,angle:c})=>new t(l,c));o.forEach(l=>t.registry.get().push(l)),await Promise.all(o.map(l=>l.fetchImageData())),t.registry.signal()}t.loadAll=a;function r(o,l,c,h){const g=~~Math.max(...t.registry.get().map(y=>y.range)),{buffer:u,startX:k,startY:x,width:w,height:b}=o.getPixels(~~l-g,~~c-g,g*2,g*2);return t.registry.get().map(y=>y.read(u,w,b,g-k,g-x,h))}t.readAll=r})(v||(v={}));class L{constructor(e){d(this,"renderImage");d(this,"width",p.singleton.trackWidth);d(this,"height",p.singleton.trackHeight);this.name=e}get startingAngle(){return Math.atan2(this.startingDirection.y,this.startingDirection.x)}get mask(){return[`<svg
        width="${this.width}px"
        height="${this.height}px"
        viewBox="0 0 ${this.width} ${this.height}"
      >`,`<rect
        width="${this.width}"
        height="${this.height}"
        fill="${v.color.offTrack}"
        shape-rendering="crispEdges"
      />`,this.path.map(e=>`<path
            d="${e}"
            stroke="${v.color.available}"
            stroke-width="${this.roadThickness}px"
            stroke-linecap="round"
            stroke-linejoin="round"
            fill="none"
            shape-rendering="crispEdges"
          />`),`<path
        d="M ${this.startingPoint.x} ${this.startingPoint.y} l ${Math.sign(this.startingDirection.x)*this.laneMarkingThickness} ${Math.sign(this.startingDirection.y)*this.laneMarkingThickness}"
        stroke="${v.color.lapLine}"
        stroke-width="${this.roadThickness}px"
        stroke-linecap="butt"
        fill="none"
      />`,"</svg>"].join("")}get image(){return[`<svg
        width="${this.width}px"
        height="${this.height}px"
        viewBox="0 0 ${this.width} ${this.height}"
      >`,`<rect
        width="${this.width}"
        height="${this.height}"
        fill="lightgreen"
      />`,this.path.map(e=>`<path
            d="${e}"
            stroke="salmon"
            stroke-width="${this.roadThickness+this.laneMarkingThickness*2}px"
            stroke-linecap="round"
            stroke-linejoin="round"
            fill="none"
          />`),this.path.map(e=>`<path
            d="${e}"
            stroke="lightgray"
            stroke-width="${this.roadThickness}px"
            stroke-linecap="round"
            stroke-linejoin="round"
            fill="none"
          />`),this.path.map(e=>`<path
            d="${e}"
            stroke="yellow"
            stroke-width="${this.laneMarkingThickness}px"
            stroke-dasharray="
              ${this.laneMarkingThickness*3},
              ${this.laneMarkingThickness*5}"
            stroke-dashoffset="${this.laneMarkingThickness}"
            stroke-linecap="round"
            stroke-linejoin="round"
            fill="none"
          />`),`<path
        d="M ${this.startingPoint.x} ${this.startingPoint.y} l ${Math.sign(this.startingDirection.x)*this.laneMarkingThickness} ${Math.sign(this.startingDirection.y)*this.laneMarkingThickness}"
        stroke="white"
        stroke-width="${this.roadThickness}px"
        stroke-linecap="butt"
        fill="none"
      />`,"</svg>"].join("")}get canvas(){var e;return(e=this.renderImage)==null?void 0:e.canvas}async fetchImageData(){return this.renderImage=await Q([this.image],{reuse:this.renderImage,clear:!0,width:this.width,height:this.height}),this.renderImage}render(e){this.canvas&&e.drawImage(this.canvas,0,0)}}(t=>{t.registry=te({});async function e(){const s=[new mt("Basic"),new xt("Advanced"),new pt("Oval"),new kt("Curvy")];s.forEach(n=>{t.registry.get()[n.name]=n}),await Promise.all(s.map(n=>n.fetchImageData())),t.registry.signal()}t.loadAll=e})(L||(L={}));function ft(){return L.registry.useHook()}const Se=L;class mt extends L{get path(){return["M 730 70 h -360 v 200 h -300 v 260 h 400 l 260 -260 v -160 Z"]}get roadThickness(){return 80}get laneMarkingThickness(){return 3}get startingPoint(){return{x:150,y:530}}get startingDirection(){return{x:1,y:0}}}class xt extends L{get path(){return["M 750 50 h -300 l -200 100 l -100 -70 h -100 v 450 h 300 v -150 h 50 v -200 h 100 v 380 h 150 Z"]}get roadThickness(){return 60}get laneMarkingThickness(){return 3}get startingPoint(){return{x:600,y:50}}get startingDirection(){return{x:1,y:0}}}class pt extends L{get path(){return["M 400 100 Q 100 100 100 300 T 400 500 T 700 300 T 400 100 Z"]}get roadThickness(){return 100}get laneMarkingThickness(){return 3}get startingPoint(){return{x:400,y:100}}get startingDirection(){return{x:-1,y:0}}}class kt extends L{get path(){return["M 100 300 c 0 100 50 200 150 200 s 50 -150 150 -150 s 50 150 150 150 s 150 -100 150 -200 s 0 -100 -100 -100 s -100 0 -100 -100 s 0 0 -100 0 s 0 0 -100 0 s 0 -50 -100 -50 s -100 150 -100 250 Z"]}get roadThickness(){return 70}get laneMarkingThickness(){return 3}get startingPoint(){return{x:400,y:100}}get startingDirection(){return{x:-1,y:0}}}const wt=Le,yt=Ne,jt=Fe;function vt(){const t=G(),e=j.useRef(null),[s,n]=j.useState(),[a,r]=j.useState();return j.useEffect(()=>{(async()=>{const l=new bt("Demo Track"),c=new W("","#33eeee",0,!1);c.visualizeSensors=!0,await Promise.all([l.fetchImageData(),c.fetchImageData()]),c.placeOnTrack(l),c.position={x:100,y:100},c.tick(0),await c.renderSensors(),n(l),r(c)})()},[n,r]),j.useEffect(()=>{if(!e.current||!a||!a.canvas||!s||!s.canvas)return;const o=t.lastRender/1e3%8*45*(Math.PI/180);a.position={x:100+50*Math.cos(o),y:100+40*Math.sin(o)},a.angle=o+Math.PI/2,a.tick(0);const l=e.current.getContext("2d",{alpha:!1});s.render(l),a.render(l)},[t.lastRender,e.current,a,s]),i.jsxs(fe,{fixed:!0,children:[i.jsx(I,{children:i.jsx(f,{children:i.jsx("h1",{children:"About: Idle Self Driving"})})}),i.jsx(I,{children:i.jsx(f,{children:i.jsx("p",{children:"This is a simple demonstration of self-driving cars receiving sensory information from their surroundings and controlling their acceleration and steering using a simple neural network."})})}),i.jsxs(I,{children:[i.jsx(f,{size:"4",children:i.jsx("canvas",{ref:e,width:`${(s==null?void 0:s.width)||1}px`,height:`${(s==null?void 0:s.height)||1}px`,style:{margin:"auto",display:"block"}})}),i.jsxs(f,{size:"8",children:[i.jsx("p",{children:"Each car has 5 sensor inputs in front of it. The reading values are between 0 and 1 indicating how far the car is from the edges of the track"}),i.jsx("p",{children:"The network outputs two values between -1 and 1. One for the acceleration of the car (negative means breaking), and the other for steering (negative for left, positive for right)."}),i.jsx("p",{children:"A simple simulation calculates the velocity and the angle of the car. Some basic friction is also calculated for speed and steering, but I didn't bother with drifting or skidding. At least not for now."})]})]}),i.jsx(I,{children:i.jsxs(f,{children:[i.jsx("p",{children:'The cars can "lose" if they hit the edges of the track. There are also some criteria for crossing the finish line in wrong direction or backtracking on the track. There is no collision between the cars, so you can think of this as being in separate tracks or ghosting.'}),i.jsx("p",{children:'A car "wins" if it successfully laps the track 3 times. The scoring is based on the distance travelled and the speed of the car. The faster a car finishes the laps the better it scores. And the further it gets before losing the better it scores.'}),i.jsx("p",{children:"At the beginning of each iteration, 10 new cars are generated based on the global best on the track and the winner of the last track. Some random choices are also made. The further we are in the training, the less random variations there are between cars"}),i.jsxs("p",{children:["The ",i.jsx(z,{icon:be})," button will start a new iteration, even if there are still cars racing in the current track. Use the ",i.jsx(z,{icon:Ie})," button to automatically advance to the next iteration after all cars have finished."]})]})}),i.jsx(I,{children:i.jsxs(f,{children:[i.jsx("p",{children:'You can also change the track the race is taking place on the right side panel. I recommend moving on to the "Advanced" track once you have trained a car that can lap around the "Basic" track. It might take a few more iterations before you have a car that can make the tight corners on the "Advanced" track.'}),i.jsx("p",{children:'There is also an "Oval" track that you can use for fine-tuning the speed of the track navigation, but be mindful that staying on it too long might cause your model to "forget" how to turn left. This is not a commentary on NASCAR™. I promise.'}),i.jsx("p",{children:'Finally, you can put all of the learnings to the test on the "Curvy" track to test both steering abilities and the speed choices of your model.'})]})}),i.jsx(I,{children:i.jsxs(f,{children:["Pro tips:",i.jsxs("ul",{children:[i.jsx("li",{children:'You can save / load / reset the state on the "Settings" tab below. Using import/export features lets you share your models'}),i.jsx("li",{children:"The ability to customize # of sensors, their angles, and ranges are there, but I haven't made the UI for it yet. You can still do it by mocking around in the saved settings, or just get the source code: the link is on top right. Coming later."}),i.jsx("li",{children:"Ability to change the # of layers and neurons in the net is also there, but doesn't have a UI either. You can use the same tricks above to play with it. Or to view your current SOTA."}),i.jsx("li",{children:'If you want your save files in plain text (json) instead of base64, add "?debug" to the end of the URL and you get a bunch of new feature'})]})]})})]})}class bt extends Se{constructor(){super(...arguments);d(this,"width",200);d(this,"height",200)}get path(){return["M 0 100 h 200"]}get roadThickness(){return 120}get laneMarkingThickness(){return 3}get startingPoint(){return{x:25,y:100}}get startingDirection(){return{x:1,y:0}}}const je=et;function It({icon:t,src:e,...s}){const n=t||e||"";return n.startsWith("data:")?i.jsx(z,{icon:n,...s}):n.includes("/")||n.includes(".")?i.jsx(z,{src:n,...s}):je[n]?i.jsx(z,{icon:je[n],...s}):i.jsx(z,{icon:tt,...s})}function F(){const t=F.useTabs(),e=p.singleton,[s,n]=j.useState(!e.helpDismissed),a=window.location.search||"";return j.useEffect(()=>{e.set({helpDismissed:!s})},[s,n]),i.jsx(Be,{children:i.jsxs(yt,{children:[i.jsxs(Ue,{children:[t.map(r=>i.jsx(pe,{exact:!0,path:`/${r.path}`,children:i.jsxs(We,{children:[i.jsx(qe,{children:i.jsxs(He,{children:[i.jsx(Ge,{slot:"start",children:r.title||r.path}),i.jsxs(ke,{slot:"end",color:"success",children:["© 2025  ",i.jsx("a",{href:"https://github.com/lepouya",target:"_blank",style:{textDecoration:"none"},children:"@lepouya"})]}),i.jsx(ke,{slot:"end",color:"light",children:i.jsx("a",{href:"https://github.com/lepouya/idle-self-driving",target:"_blank",style:{textDecoration:"none"},children:i.jsx("small",{children:"view source"})})})]})}),i.jsx(we,{id:"tab-page",children:r.content}),i.jsx(_e,{trigger:s?"tab-page":void 0,isOpen:s,showBackdrop:!0,side:"start",alignment:"start",onDidDismiss:()=>n(!1),children:i.jsxs(we,{class:"ion-padding",children:[i.jsx(vt,{}),i.jsx(P,{onClick:()=>n(!1),children:"Close"})]})})]})},`tab-${r.path}`)),t.filter(r=>!!r.from).map(r=>i.jsx(pe,{exact:!0,path:r.from,children:i.jsx(De,{to:`/${r.path}${a}`})},`default-tab-${r.path}`))]}),i.jsx(Je,{slot:"bottom",children:t.map(r=>(r.icon||r.label)&&i.jsxs(jt,{tab:r.path,href:`/${r.path}${a}`,children:[r.icon&&i.jsx(It,{"aria-hidden":"true",icon:r.icon}),r.label&&i.jsx(S,{children:r.label})]},`tab-button-${r.path}`))})]})})}const ee=te({});F.register=function(t){ee.get()[t.path]=t,ee.signal()};F.unregister=function(t){delete ee.get()[typeof t=="string"?t:t.path],ee.signal()};F.useTabs=function(){const t=ee.useHook();return Object.values(t)};function A(t,e){return t==null||t==null||typeof t=="string"?A.word(t??void 0,e):t instanceof Date?A.time(t.getTime(),e):typeof t=="number"?A.number(t,e):""}A.number=function(t,e){const s=(Math.log10(Math.abs(t))<3?e==null?void 0:e.smallPrec:e==null?void 0:e.prec)??(e==null?void 0:e.prec)??0;let n=isFinite(t)?t.toFixed(s):t.toString();return n&&(e!=null&&e.alwaysShowSign)&&!"+-".includes(n[0])&&t>=0&&(n="+"+n),n};A.time=function(t,e){const s=(e==null?void 0:e.len)??"long",n=(e==null?void 0:e.sep)??s==="long"?", ":":",a=(e!=null&&e.oxfordComma?n:"")+((e==null?void 0:e.lastSep)??s==="long"?" and ":n),r=(e==null?void 0:e.now)??s==="long"?"now":"",o=(e==null?void 0:e.never)??s==="long"?"never":"",l=(e==null?void 0:e.ago)??s==="long"?"ago":"";if(o&&(t<0||(e==null?void 0:e.epoch)!=null&&(e.epoch<=0||t-e.epoch<0)))return o;if(r&&(t===0||(e==null?void 0:e.epoch)!=null&&t===e.epoch))return r;(e==null?void 0:e.epoch)!=null&&(t-=e.epoch);let c=Math.floor(t/1e3),h=Math.floor(t-c*1e3),g=Math.floor(c/60);c-=g*60;let u=Math.floor(g/60);g-=u*60;let k=Math.floor(u/24);u-=k*24;let x=Math.floor(k/365);if(k-=x*365,e!=null&&e.millis||(h=0),r!=null&&k+u+g+c+h===0)return r;let w=[];if(s!=="long"?w=[x>0?x.toFixed(0):"",k>0?k.toFixed(0):"",u>0||s==="short"?u.toFixed(0):"",g>0||s==="short"?g.toFixed(0):"",(c+h/1e3).toFixed(!(e!=null&&e.millis)||s==="tiny"&&h===0?0:3)].map(y=>s==="short"&&(y.length===1||y.indexOf(".")===1)?"0"+y:y):w=[[x,"year"],[k,"day"],[u,"hour"],[g,"minute"],[c,"second",x+k+u+g===0,h]].map(([y,D,N=!1,O=0])=>y>0||O>0||N&&y===0?y.toString()+(O>0?"."+O.toString():"")+" "+D+(y===1?"":"s"):""),w=w.filter(y=>!!y),w.length>2){const y=w.pop();w=[w.join(n),y]}let b=w.join(a)+(l?" "+l:"");return b&&(e!=null&&e.alwaysShowSign)&&t>=0&&s!=="long"&&!"+-".includes(b[0])&&(b="+"+b),b};A.word=function(t,e){return t||(t=(Math.abs(Math.abs((e==null?void 0:e.count)??0)-1)<=((e==null?void 0:e.tolerance)??.001)?e==null?void 0:e.singularName:e==null?void 0:e.pluralName)??(e==null?void 0:e.name)),(e==null?void 0:e.condition)??!0?!t&&!((e==null?void 0:e.allowEmpties)??!1)?"":(e==null?void 0:e.capitalize)??!0?(t??"").replace(/([a-z])([A-Z]|_\S)/g,(s,n,a)=>`${n} ${a.slice(-1)}`).replace(/(?:^|\s)\w(?=\w)/g,s=>s.toUpperCase()):t??"":""};function de(){var l,c,h;const t=G(),e=j.useRef(null),s=ft(),n=ut(),a=s[t.currentTrack];j.useEffect(()=>{W.nextGeneration(a,!1)},[a]),j.useEffect(()=>{var g;if(e.current){const u=e.current.getContext("2d",{alpha:!1});t.renderSensors?(g=n[0])==null||g.renderSensors().then(k=>{u.clearRect(0,0,t.trackWidth,t.trackHeight),u.resetTransform(),u.drawImage(k.canvas,0,0)}):(a.render(u),W.renderAll(u))}},[t.currentTrack,e.current,t.lastRender]);const r=Math.max(...n.map(g=>g.score.score))||0,o=n.filter(g=>!g.collided).length;return i.jsx(fe,{children:i.jsxs(I,{children:[i.jsx(f,{size:"8",children:i.jsx("canvas",{ref:e,width:`${t.trackWidth}px`,height:`${t.trackHeight}px`})}),i.jsxs(f,{size:"4",children:[i.jsxs(E,{children:[i.jsxs(S,{children:["Iteration ",t.numIterations]}),i.jsx(P,{slot:"end",expand:"block",title:"Skip to next iteration",onClick:()=>W.nextGeneration(a,!0),children:i.jsx(z,{icon:be})}),i.jsx(P,{slot:"end",expand:"block",color:t.autoAdvance?"primary":"medium",title:"Toggle auto-advance at the end of each iteration",onClick:()=>t.set({autoAdvance:!t.autoAdvance}),children:i.jsx(z,{icon:Ie})}),i.jsx(P,{slot:"end",expand:"block",color:t.globalPaused?"medium":"primary",title:t.globalPaused?"Resume":"Pause",onClick:()=>t.set({globalPaused:!t.globalPaused}),children:i.jsx(z,{icon:t.globalPaused?st:it})})]}),i.jsxs(E,{children:[i.jsx(S,{children:"Leader Score"}),i.jsx(S,{slot:"end",children:A(r,{prec:2})})]}),i.jsxs(E,{children:[i.jsx(S,{children:"Active Cars"}),i.jsxs(S,{slot:"end",children:[o,"/",n.length]})]}),i.jsx(E,{children:i.jsx(S,{children:" "})}),i.jsx(E,{children:i.jsx(Ye,{label:"Track Selection",interface:"alert",value:t.currentTrack,onIonChange:g=>{t.set({currentTrack:g.detail.value})},children:Object.keys(s).map(g=>i.jsx(Ke,{value:g,children:g},g))})}),i.jsxs(E,{children:[i.jsxs(S,{children:["Best Score on ",t.currentTrack," Track"]}),i.jsx(S,{slot:"end",children:A(Math.max(r,((l=t.sotaScore[t.currentTrack])==null?void 0:l.score)||0),{prec:2})})]}),i.jsx(E,{children:i.jsx(S,{children:" "})}),i.jsxs(E,{children:[i.jsx(S,{children:"Simulation Speed"}),i.jsxs(S,{slot:"end",children:[A(((c=t.execution.tick)==null?void 0:c.tps)||0)," tps"]})]}),i.jsxs(E,{children:[i.jsx(S,{children:"Rendering Speed"}),i.jsxs(S,{slot:"end",children:[A(((h=t.execution.tick)==null?void 0:h.fps)||0)," fps"]})]}),i.jsx(E,{children:i.jsx(Qe,{checked:t.manualControl,onIonChange:g=>{t.set({manualControl:g.detail.checked}),W.nextGeneration(a,!1)},children:"Manually Controlled Car"})})]})]})})}de.init=()=>{F.register({path:"driving",content:i.jsx(de,{}),icon:"speedometerOutline",label:"Driving",title:"Idle Self Driving",from:"/"})};function ge(){return i.jsxs(fe,{children:[i.jsx(Tt,{}),i.jsx(Mt,{}),i.jsx($t,{}),i.jsx(At,{})]})}ge.init=()=>{F.register({path:"settings",content:i.jsx(ge,{}),icon:"settingsOutline",label:"Settings",title:"Settings"})};function Tt(){const t=G(),[e,s]=j.useState("");return i.jsxs(ne,{children:[i.jsx(re,{children:i.jsx(ae,{children:i.jsx(I,{children:i.jsx(f,{size:"12",className:"ion-text-center",children:i.jsx(Z,{children:"Data"})})})})}),i.jsxs(oe,{children:[i.jsxs(I,{children:[i.jsxs(f,{size:"12",children:["Started"," ",A.time(t.lastTick??0,{epoch:t.lastReset})]}),i.jsxs(f,{size:"12",children:["This session started"," ",A.time(t.lastTick??0,{epoch:t.lastLoaded})]}),i.jsxs(f,{size:"12",children:["Last saved"," ",A.time(t.lastTick??0,{epoch:t.lastSaved})]})]}),i.jsxs(I,{children:[i.jsx(f,{size:"6",children:i.jsx(P,{onClick:()=>{p.load().then(()=>p.save()).then(ie)},expand:"block",children:"Load"})}),i.jsx(f,{size:"6",children:i.jsx(P,{onClick:()=>p.save(),expand:"block",children:"Save"})}),i.jsx(f,{size:"6",children:i.jsx(P,{onClick:Ct,expand:"block",children:"Load from File"})}),i.jsx(f,{size:"6",children:i.jsx(P,{onClick:St,expand:"block",children:"Save to File"})}),i.jsx(f,{size:"6",children:i.jsx(P,{onClick:()=>{t.load(me(e)),p.save().then(ie)},expand:"block",children:"Import Text"})}),i.jsx(f,{size:"6",children:i.jsx(P,{onClick:()=>s(le(t.save(),t.isDebug())),expand:"block",children:"Export Text"})}),i.jsx(f,{size:"12",children:i.jsx(ve,{label:"Data for import/export",labelPlacement:"floating",fill:"outline",rows:5,autoGrow:!0,value:e,onIonInput:n=>s(n.detail.value??"")})})]})]})]})}function Mt(){const t=G(),[e,s]=j.useState(t.ticksPerSec),[n,a]=j.useState(t.rendersPerSec),[r,o]=j.useState(t.saveFrequencySecs);return j.useEffect(()=>{s(t.ticksPerSec)},[t.ticksPerSec]),j.useEffect(()=>{a(t.rendersPerSec)},[t.rendersPerSec]),j.useEffect(()=>{o(t.saveFrequencySecs)},[t.saveFrequencySecs]),i.jsxs(ne,{children:[i.jsx(re,{children:i.jsx(ae,{children:i.jsx(I,{children:i.jsx(f,{size:"12",className:"ion-text-center",children:i.jsx(Z,{children:"Advanced Settings"})})})})}),i.jsxs(oe,{children:[i.jsxs(I,{children:[i.jsx(f,{size:"12",children:"If you are having performance issues, increase the time between updates. Faster updating frequncies lead to better experience but might use a lot of CPU."}),i.jsx(f,{size:"6",className:"ion-text-right",children:"Updating frequency:"}),i.jsxs(f,{size:"6",className:"ion-text-center",children:[Math.floor(1e3/t.ticksPerSec),"ms"]}),i.jsx(f,{size:"6"}),i.jsx(f,{size:"6",children:i.jsx(he,{min:6,max:100,step:1,pin:!0,pinFormatter:l=>`${Math.floor(1e3/l)}ms`,value:e,onIonInput:l=>s(l.detail.value),onIonChange:l=>{t.set({ticksPerSec:l.detail.value})},className:"ion-no-padding"})}),i.jsx(f,{size:"6",className:"ion-text-right",children:"Rendering frequency:"}),i.jsxs(f,{size:"6",className:"ion-text-center",children:[Math.floor(1e3/t.rendersPerSec),"ms"]}),i.jsx(f,{size:"6"}),i.jsx(f,{size:"6",children:i.jsx(he,{min:1,max:60,step:1,pin:!0,pinFormatter:l=>`${Math.floor(1e3/l)}ms`,value:n,onIonInput:l=>a(l.detail.value),onIonChange:l=>{t.set({rendersPerSec:l.detail.value})},className:"ion-no-padding"})})]}),i.jsxs(I,{children:[i.jsx(f,{size:"12",children:"Change how often the session is saved in the background. More frequent saving leads to faster backups, but increases CPU and I/O usage"}),i.jsx(f,{size:"6",className:"ion-text-right",children:"Saving frequency:"}),i.jsx(f,{size:"6",className:"ion-text-center",children:A.time(1e3*t.saveFrequencySecs,{ago:""})}),i.jsx(f,{size:"6"}),i.jsx(f,{size:"6",children:i.jsx(he,{min:1,max:60,step:1,pin:!0,pinFormatter:l=>A.time(1e3*(600/l),{ago:"",len:"tiny"}).replace(":","m:")+"s",value:600/r,onIonInput:l=>o(600/l.detail.value),onIonChange:l=>{t.set({saveFrequencySecs:600/l.detail.value})},className:"ion-no-padding"})})]})]})]})}function $t(){const[t,e]=j.useState(!1);function s(){t&&(e(!1),p.reset(),C.clear().then(ie))}return i.jsxs(ne,{children:[i.jsx(re,{children:i.jsx(ae,{children:i.jsx(I,{children:i.jsx(f,{size:"12",className:"ion-text-center",children:i.jsx(Z,{children:"Reset"})})})})}),i.jsx(oe,{children:i.jsxs(I,{children:[i.jsx(f,{size:"12",children:i.jsx(Z,{color:"danger",children:"WARNING: this will completely reset your settings and delete all saved progress. Only use this if you want to restart from the beginning, or if something in the settings is so messed up that it is unusable."})}),i.jsx(f,{size:"12",children:i.jsx(Ze,{justify:"end",checked:t,onIonChange:()=>e(n=>!n),children:"I understand what this means and still want to reset"})}),i.jsx(f,{size:"12",class:"ion-text-right",children:i.jsx(P,{onClick:s,disabled:!t,color:t?"danger":"medium",children:"Reset everything"})})]})})]})}function At(){const t=G();return t.isDebug()&&i.jsxs(ne,{children:[i.jsx(re,{children:i.jsx(ae,{children:i.jsx(I,{children:i.jsx(f,{size:"12",className:"ion-text-center",children:i.jsx(Z,{children:"Debug Context"})})})})}),i.jsx(oe,{children:i.jsx(I,{children:i.jsx(f,{size:"12",children:i.jsx(ve,{autoGrow:!0,readonly:!0,value:le(t,!0)})})})})]})}function St(){const t=p.singleton,e="idle-self-driving".replace(/\W/g,"_"),s="0.9.0".replace(/\W/g,"_"),n=new Date().toISOString().replace(/\D/g," ").trim().replace(/\D/g,"-"),a=`${e}-v${s}-${n}`,r=le(t.save(),t.isDebug()),o=new Blob([r],{type:"text/plain"}),l=URL.createObjectURL(o),c=document.createElement("a");c.href=l,c.download=a,c.click(),URL.revokeObjectURL(l)}function Ct(){const t=document.createElement("input");t.type="file",t.addEventListener("change",function(e){const s=e.target.files;if(!s||s.length===0||!s[0])return;const n=new FileReader;n.onload=function(a){var l;const r=(l=a.target)==null?void 0:l.result;if(!r||typeof r!="string")return;const o=p.singleton;o.load(me(r)),o.tick(void 0,"load"),p.save().then(ie)},n.readAsText(s[0])},!1),t.click()}function ie(){Xe().push("/"),window.location.reload()}function ue(){const t=G();return j.useEffect(()=>($.addEventListeners(),C.initialize(),()=>$.removeEventListeners()),[]),j.useEffect(()=>(p.addTickTimer(),()=>p.removeTickTimer()),[t.ticksPerSec]),null}ue.initialize=async function(){await C.initialize(),de.init(),ge.init(),await p.load(),await Promise.all([Se.loadAll(),v.loadAll()])};Ve();window.addEventListener("load",async()=>{const t=document.createElement("div");t.id="root",document.body.appendChild(t);const e=Re.createRoot(t);await ue.initialize(),e.render(i.jsx(j.StrictMode,{children:i.jsxs(wt,{children:[i.jsx(ue,{}),i.jsx(F,{})]})}))},!1);
